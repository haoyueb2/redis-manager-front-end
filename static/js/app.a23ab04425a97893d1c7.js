webpackJsonp([1],{"+HVg":function(e,t){},"/w8a":function(e,t){},"02K+":function(e,t){},"09yM":function(e,t){},"0Cx0":function(e,t){},"1csI":function(e,t){},"3FC4":function(e,t){},"7xIN":function(e,t){},AS41:function(e,t,r){e.exports=r.p+"static/img/background.2e57181.jpg"},D8Fm:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=r("hRKE"),i=r.n(s),a=r("/BUc");r("chxV");var n={props:{value:{type:String,default:""},options:{type:Object,default:function(){return{mode:"text/javascript",lineNumbers:!0,lineWrapping:!0}}}},data:function(){return{skipNextChangeEvent:!1}},ready:function(){var e=this;this.editor=a.fromTextArea(this.$el.querySelector("textarea"),this.options),this.editor.setValue(this.value),this.editor.on("change",function(t){e.skipNextChangeEvent?e.skipNextChangeEvent=!1:(e.value=t.getValue(),e.$emit&&e.$emit("change",t.getValue()))})},mounted:function(){var e=this;this.editor=a.fromTextArea(this.$el.querySelector("textarea"),this.options),this.editor.setValue(this.value),this.editor.on("change",function(t){e.skipNextChangeEvent?e.skipNextChangeEvent=!1:e.$emit&&(e.$emit("change",t.getValue()),e.$emit("input",t.getValue()))})},watch:{value:function(e,t){if(e!==this.editor.getValue()){this.skipNextChangeEvent=!0;var r=this.editor.getScrollInfo();this.editor.setValue(e),this.editor.scrollTo(r.left,r.top)}},options:function(e,t){if("object"===(void 0===e?"undefined":i()(e)))for(var r in e)e.hasOwnProperty(r)&&this.editor.setOption(r,e[r])}},beforeDestroy:function(){this.editor&&this.editor.toTextArea()}},o=r("C7Lr")(n,{render:function(){return this.$createElement,this._self._c,this._m(0)},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"vue-codemirror-wrap"},[t("textarea")])}]},!1,function(e){r("alXC")},null,null);t.default=o.exports},EgnH:function(e,t){},NHnr:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=r("kV13"),i=r("b8UZ"),a=r("t359"),n=r("I29D"),o=r.n(n);function l(e){return null==e||"undefined"===e||""===e||"null"===e}function u(e){return/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e)}function c(e){return/^1[3|4|5|7|8][0-9]{9}$/.test(e)}function d(e){return/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\:([0-9]|[1-9]\d|[1-9]\d{2}|[1-9]\d{3}|[1-5]\d{4}|6[0-4]\d{3}|65[0-4]\d{2}|655[0-2]\d|6553[0-5])$/.test(e)}var m=r("TcQY"),p=r.n(m);function f(e,t){var r={showClose:!0,message:e,offset:60};l(t)||(r.type=t),"success"===t?m.Message.success(r):"warning"===t?m.Message.warning(r):"error"===t?m.Message.error(r):m.Message.info(r)}var v={info:function(e){return f(e,null)},success:function(e){return f(e,"success")},warning:function(e){return f(e,"warning")},error:function(e){return f(e,"error")}},g=r("5inH"),h={data:function(){var e=this;return{user:{},authorization:{},rules:{userRole:[{required:!0,message:"Please select user role",trigger:"blur"}],userName:[{required:!0,message:"Please enter user name",trigger:"blur"},{required:!0,validator:function(t,r,s){var i="/user/validateUserName/"+r;he.get(i,null,function(t){var i=t.data;0==i.code?s():e.user.userId!==i.data.userId?s(new Error(r+" has been used")):s()},function(e){return s(new Error("Network error"))})},trigger:"blur"}],password:[{required:!0,message:"Please enter password",trigger:"blur"}],email:[{trigger:"blur"}],mobile:[{trigger:"blur"}]},activeName:"second"}},methods:{Register:function(e){var t=this;console.log(this.user),this.$refs[e].validate(function(r){r&&(t.user.groupId=1,console.log(t.user),he.post("/user/addUser",t.user,function(r){0==r.data.code?(t.$refs[e].resetFields(),v.success("successfully registered")):v.error("register failed")},function(e){v.error(e)}))})}},mounted:function(){}},b=r("C7Lr")(h,{render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("el-form",{ref:"user",attrs:{model:e.user,rules:e.rules}},[r("el-form-item",{attrs:{prop:"userRole",label:"User Role"}},[r("el-select",{attrs:{placeholder:"Please select user role"},model:{value:e.user.userRole,callback:function(t){e.$set(e.user,"userRole",t)},expression:"user.userRole"}},[r("el-option",{attrs:{label:"Admin",value:1}}),e._v(" "),r("el-option",{attrs:{label:"Super Admin",value:0}})],1)],1),e._v(" "),r("el-form-item",{attrs:{prop:"userName"}},[r("el-input",{attrs:{"prefix-icon":"el-icon-user",placeholder:"User Name"},model:{value:e.user.userName,callback:function(t){e.$set(e.user,"userName","string"==typeof t?t.trim():t)},expression:"user.userName"}})],1),e._v(" "),r("el-form-item",{attrs:{prop:"password"}},[r("el-input",{attrs:{"prefix-icon":"el-icon-key",type:"password",placeholder:"Password","show-password":""},model:{value:e.user.password,callback:function(t){e.$set(e.user,"password","string"==typeof t?t.trim():t)},expression:"user.password"}})],1),e._v(" "),r("el-form-item",{attrs:{prop:"email"}},[r("el-input",{attrs:{placeholder:"Email Address"},model:{value:e.user.email,callback:function(t){e.$set(e.user,"email","string"==typeof t?t.trim():t)},expression:"user.email"}})],1),e._v(" "),r("el-form-item",{attrs:{prop:"mobile"}},[r("el-input",{attrs:{placeholder:"Mobile Number"},model:{value:e.user.mobile,callback:function(t){e.$set(e.user,"mobile","string"==typeof t?t.trim():t)},expression:"user.mobile"}})],1),e._v(" "),r("el-form-item",[r("el-button",{staticStyle:{width:"100%"},attrs:{type:"primary"},on:{click:function(t){return e.Register("user")}}},[e._v("Register")])],1),e._v(" "),e.authorization.enabled?r("el-form-item",[r("el-button",{staticStyle:{width:"100%"},attrs:{type:"success"}},[r("el-link",{staticStyle:{color:"#fff"},attrs:{href:e.authorization.server+e.authorization.siteKey,underline:!1}},[e._v(e._s(e.authorization.companyName)+" Sign In")])],1)],1):e._e()],1)],1)},staticRenderFns:[]},!1,function(e){r("R8Uw")},"data-v-09ad46a7",null).exports,_={data:function(){return{user:{},authorization:{},rules:{userName:[{required:!0,message:"Please enter user name",trigger:"blur"}],password:[{required:!0,message:"Please enter password",trigger:"blur"}]},activeName:"first"}},methods:{handleClick:function(e,t){},getAuthorization:function(){var e=this;he.get("/system/getAuthorization",null,function(t){var r=t.data.data;r.server+=r.server.endsWith("/")?"":"/",e.authorization=r},function(e){v.error("Get authorization failed")})},signIn:function(e){var t=this;this.$refs[e].validate(function(e){e&&he.post("/user/login",t.user,function(e){var r=e.data;0==r.code?(Le.dispatch("setUser",r.data),t.$router.push({name:"index"})):v.error("User name or password wrong")},function(e){v.error(e)})})}},mounted:function(){this.getAuthorization(),Le.dispatch("setUser",{userRole:2}),Le.dispatch("setCurrentGroup",{}),Le.dispatch("setGroupList",[])},components:{Register:b}},w={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("el-container",{staticStyle:{"background-image":"linear-gradient(0deg,#1ac5fa,#2ba3de 51%,#1d71f2)"}},[s("img",{staticStyle:{position:"absolute","z-index":"0",left:"0",top:"0",width:"100%",opacity:"0.1"},attrs:{src:r("AS41")}}),e._v(" "),s("div",{staticClass:"login-wrapper"},[s("el-card",{staticClass:"content-wrapper",attrs:{shadow:"hover"}},[s("el-tabs",{on:{"tab-click":e.handleClick},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[s("el-tab-pane",{attrs:{label:"登录",name:"first"}},[s("div",[s("el-form",{ref:"user",attrs:{model:e.user,rules:e.rules}},[s("el-form-item",{attrs:{prop:"userName"}},[s("el-input",{attrs:{"prefix-icon":"el-icon-user",placeholder:"User Name"},model:{value:e.user.userName,callback:function(t){e.$set(e.user,"userName","string"==typeof t?t.trim():t)},expression:"user.userName"}})],1),e._v(" "),s("el-form-item",{attrs:{prop:"password"}},[s("el-input",{attrs:{"prefix-icon":"el-icon-key",type:"password",placeholder:"Password","show-password":""},model:{value:e.user.password,callback:function(t){e.$set(e.user,"password","string"==typeof t?t.trim():t)},expression:"user.password"}})],1),e._v(" "),s("el-form-item",[s("el-button",{staticStyle:{width:"100%"},attrs:{type:"primary"},on:{click:function(t){return e.signIn("user")}}},[e._v("Sign In")])],1),e._v(" "),e.authorization.enabled?s("el-form-item",[s("el-button",{staticStyle:{width:"100%"},attrs:{type:"success"}},[s("el-link",{staticStyle:{color:"#fff"},attrs:{href:e.authorization.server+e.authorization.siteKey,underline:!1}},[e._v(e._s(e.authorization.companyName)+" Sign In")])],1)],1):e._e()],1)],1)]),e._v(" "),s("el-tab-pane",{attrs:{label:"注册",name:"second"}},[s("Register")],1)],1)],1)],1)])},staticRenderFns:[]},y=r("C7Lr")(_,w,!1,function(e){r("QGkJ")},"data-v-0673f1a2",null).exports;function L(e){var t=new Date(e),r=t.getFullYear(),s=t.getMonth()+1,i=t.getDate(),a=t.getHours(),n=t.getMinutes(),o=t.getSeconds();return r+"-"+C(s)+"-"+C(i)+" "+C(a)+":"+C(n)+":"+C(o)}function C(e){return e<10?"0"+e:e}function I(e,t){var r=Le.getters.getCurrentGroup.groupId;if(l(r))ve.push({name:"404"});else{var s="/cluster/getCluster/"+r+"/"+e;he.get(s,null,function(e){var r=e.data;0===r.code?t(r.data):(ve.push({name:"404"}),v.error("Get clsuter failed"))},function(e){v.error(e)})}}var N={props:{clusterId:{type:Number}},data:function(){var e=this;return{cluster:{nodeList:[{value:""}]},rules:{clusterName:[{required:!0,validator:function(t,r,s){if(l(r)||l(r.trim()))return s(new Error("Please enter cluster name"));var i="/cluster/validateClusterName/"+r;he.get(i,null,function(t){var i=t.data;if(0!=i.code){var a=i.data;return e.clusterId==a.clusterId&&r==a.clusterName&&s(),s(new Error(r+" has exist"))}s()},function(e){return s(new Error("Network error, "+e))})},trigger:"blur"}],redisNode:[{required:!0,validator:function(e,t,r){return l(t)||l(t.trim())?r(new Error("Please enter redis node")):d(t)?void r():r(new Error("Incorrect format"))},trigger:"blur"},{required:!0,validator:function(t,r,s){var i={redisPassword:e.cluster.redisPassword},a=r.split(":"),n={host:a[0],port:a[1]};i.redisNode=n,he.post("/validate/redisNode",i,function(e){if(0!=e.data.code)return s(new Error("Connection refused."));s()},function(e){return s(new Error("Network error, "+e))})},trigger:"blur"}],installationEnvironment:[{required:!0,validator:function(e,t,r){if(l(t))return r(new Error("Please select environment"));r()},trigger:"change"}]},saveClusterLoading:!1}},methods:{saveCluster:function(e){var t=this;this.$refs[e].validate(function(r){if(r){var s=t.currentGroup;if(l(s)||l(s.groupId))return;t.cluster.groupId=s.groupId,t.cluster.userId=Le.getters.getUserId;var i="";t.cluster.nodeList.forEach(function(e){i+=e.value+","}),t.cluster.nodes=i;var a;a=l(t.clusterId)?"/cluster/importCluster":"/cluster/updateCluster",t.saveClusterLoading=!0,he.post(a,t.cluster,function(r){0==r.data.code?(t.$refs[e].resetFields(),t.$router.push({name:"dashboard",params:{groupId:s.groupId}}),t.$emit("closeDialog",!1)):console.error("Save cluster failed"),t.saveClusterLoading=!1},function(e){t.saveClusterLoading=!1,console.error(e)})}})},removeNode:function(e){if(!(this.cluster.nodeList.length<=1)){var t=this.cluster.nodeList.indexOf(e);-1!==t&&this.cluster.nodeList.splice(t,1)}},addNode:function(){this.cluster.nodeList.length>=20||this.cluster.nodeList.push({value:"",key:Date.now()})},nodesToNodeList:function(e){var t=[];return e.split(",").forEach(function(e){l(e)||t.push({value:e})}),t}},computed:{currentGroup:function(){return Le.getters.getCurrentGroup},installationEnvironmentList:function(){return Le.getters.getInstallationEnvironmentList}},mounted:function(){var e=this;l(this.clusterId)?this.cluster={nodeList:[{value:""}]}:I(this.clusterId,function(t){var r=e.nodesToNodeList(t.nodes);t.nodeList=r,e.cluster=t})}},k=r("C7Lr")(N,{render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{directives:[{name:"loading",rawName:"v-loading",value:e.saveClusterLoading,expression:"saveClusterLoading"}]},[r("el-form",{ref:"cluster",attrs:{model:e.cluster,rules:e.rules,"label-width":"130px",size:"small"}},[r("el-form-item",{attrs:{label:"Group Name"}},[r("el-tag",{attrs:{size:"small"}},[e._v(e._s(e.currentGroup.groupName))])],1),e._v(" "),r("el-form-item",{attrs:{label:"Cluster Name",prop:"clusterName"}},[r("el-input",{attrs:{maxlength:"30","show-word-limit":"",autocomplete:"off"},model:{value:e.cluster.clusterName,callback:function(t){e.$set(e.cluster,"clusterName",t)},expression:"cluster.clusterName"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"Redis Password",prop:"redisPassword"}},[r("el-input",{attrs:{maxlength:"255","show-password":"",autocomplete:"off"},model:{value:e.cluster.redisPassword,callback:function(t){e.$set(e.cluster,"redisPassword","string"==typeof t?t.trim():t)},expression:"cluster.redisPassword"}})],1),e._v(" "),e._l(e.cluster.nodeList,function(t,s){return r("el-form-item",{key:t.key,attrs:{label:"Redis Node "+(s+1),prop:"nodeList."+s+".value",rules:e.rules.redisNode}},[r("el-input",{model:{value:t.value,callback:function(r){e.$set(t,"value","string"==typeof r?r.trim():r)},expression:"node.value"}},[r("el-button",{attrs:{slot:"append",icon:"el-icon-delete"},on:{click:function(r){return r.preventDefault(),e.removeNode(t)}},slot:"append"})],1)],1)}),e._v(" "),r("el-form-item",{attrs:{label:"Environment",prop:"installationEnvironment"}},[r("el-radio-group",{model:{value:e.cluster.installationEnvironment,callback:function(t){e.$set(e.cluster,"installationEnvironment",t)},expression:"cluster.installationEnvironment"}},e._l(e.installationEnvironmentList,function(t){return r("el-radio",{key:t.type,attrs:{label:t.type}},[e._v(e._s(t.name))])}),1)],1),e._v(" "),r("el-form-item",{attrs:{label:"Cluster Info",prop:"clusterInfo"}},[r("el-input",{model:{value:e.cluster.clusterInfo,callback:function(t){e.$set(e.cluster,"clusterInfo",t)},expression:"cluster.clusterInfo"}})],1)],2),e._v(" "),r("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{size:"small"},on:{click:function(t){return e.addNode()}}},[e._v("New Node")]),e._v(" "),null==e.clusterId||""==e.clusterId?r("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.saveCluster("cluster")}}},[e._v("Confirm")]):r("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.saveCluster("cluster")}}},[e._v("Update")])],1)],1)},staticRenderFns:[]},!1,function(e){r("rGuf")},"data-v-17ada8ca",null).exports;r("F8lt");var M={components:{editCluster:k},data:function(){return{isCollapse:!1,active:!0,permission:!0,importVisible:!1,selectGroupId:""}},methods:{signOut:function(){this.$router.push({name:"login"})},toDashboard:function(){this.$router.push({name:"dashboard",params:{groupId:this.selectGroupId}})},toMachineManage:function(){this.$router.push({name:"machine-manage",params:{groupId:this.selectGroupId}})},selectGroup:function(){var e=this;if(l(this.selectGroupId))v.error("Select group failed");else{this.groupList.forEach(function(t){e.selectGroupId===t.groupId&&e.getUserRole(t)});var t=this.$route.path;("/"===t||t.indexOf("redis-monitor")>0||t.indexOf("group-manage")>0)&&this.toDashboard()}},getUserRole:function(e){var t={userId:this.currentUser.userId,groupId:e.groupId};he.post("/user/getUserRole",t,function(t){var r=t.data;0==r.code&&(Le.dispatch("setUserRole",r.data),Le.dispatch("setCurrentGroup",e))},function(e){v.error(e)})},handleCommand:function(e){"profile"==e&&this.toUserProfile()},toUserProfile:function(){this.$router.push({name:"profile",params:{userId:this.currentUser.userId}})},toDataOperation:function(){this.$router.push({name:"data-operation",params:{groupId:this.selectGroupId}})},handleOpen:function(e,t){},handleClose:function(e,t){},errorHandler:function(){return!0},collapseHandler:function(){this.isCollapse=!this.isCollapse},getGroupList:function(){var e=this,t=Le.getters.getUser;he.post("/group/getGroupList",t,function(t){if(0==t.data.code){var r=t.data.data;r.forEach(function(e){e.time=L(e.updateTime)}),Le.dispatch("setGroupList",r);var s=e.currentGroup,i=Le.getters.getUser;(l(s)||l(s.groupId))&&r.forEach(function(t){t.groupId==i.groupId&&(e.selectGroupId=i.groupId,Le.dispatch("setCurrentGroup",t),e.getUserRole(t))})}else v.error("Get group list failed")},function(e){v.error(e)})},closeDialog:function(e){var t=this;this.active=!1,this.$nextTick(function(){return t.active=!0}),this.importVisible=e},getUserFromSession:function(){he.get("/user/getUserFromSession",null,function(e){var t=e.data;0==t.code&&Le.dispatch("setUser",t.data)},function(e){v.error("Auto get user failed.")})}},computed:{currentUser:function(){return Le.getters.getUser},currentGroup:function(){return Le.getters.getCurrentGroup},groupList:function(){return Le.getters.getGroupList}},mounted:function(){this.getUserFromSession(),this.getGroupList();var e;e=l(this.currentGroup)||l(this.currentGroup.groupId)?this.currentUser.groupId:this.currentGroup.groupId,this.selectGroupId=e,"/"==this.$route.path&&this.toDashboard()},created:function(){var e,t,r,s,i,a;e=function(e){Le.dispatch("setUserIp",e)},t=new(window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection)({iceServers:[]}),r=function(){},s={},i=/([0-9]{1,3}(\.[0-9]{1,3}){3}|[a-f0-9]{1,4}(:[a-f0-9]{1,4}){7})/g,a=function(t){s[t]||e(t),s[t]=!0},t.createDataChannel(""),t.createOffer().then(function(e){e.sdp.split("\n").forEach(function(e){e.indexOf("candidate")<0||e.match(i).forEach(a)}),t.setLocalDescription(e,r,r)}).catch(function(e){}),t.onicecandidate=function(e){e&&e.candidate&&e.candidate.candidate&&e.candidate.candidate.match(i)&&e.candidate.candidate.match(i).forEach(a)}}},S={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("el-container",{attrs:{id:"index"}},[s("el-header",{staticClass:"header header-wrapper"},[s("div",{staticClass:"grid-content logo-wrapper"},[s("i",{staticClass:"el-icon-s-fold aside-operation",on:{click:e.collapseHandler}}),e._v(" "),s("img",{attrs:{src:r("AS41"),height:"20px",width:"37px"}}),e._v(" "),s("p",{attrs:{id:"headerTitle"}},[e._v("Redis Manager")])]),e._v(" "),s("div",{staticClass:"grid-content right-content",attrs:{id:"right-content"}},[s("div",{staticClass:"user-info"},[s("el-dropdown",{staticClass:"user-dropdown",on:{command:e.handleCommand}},[s("a",{attrs:{id:"currentName"}},[e._v(e._s(e.currentUser.userName))]),e._v(" "),s("el-dropdown-menu",{staticStyle:{"min-width":"180px"},attrs:{slot:"dropdown"},slot:"dropdown"},[s("el-dropdown-item",{attrs:{disabled:""}},[e._v("\n              Signed in as\n              "),s("b",[e._v(e._s(e.currentUser.userName))])]),e._v(" "),s("el-dropdown-item",{attrs:{command:"profile",divided:""}},[e._v("Profile")]),e._v(" "),s("el-dropdown-item",{attrs:{divided:""},nativeOn:{click:function(t){return e.signOut(t)}}},[e._v("Sign out")])],1)],1)],1)])]),e._v(" "),s("el-container",{staticClass:"aside-main-wrapper"},[s("el-aside",{class:{"is-collapse":e.isCollapse},staticStyle:{width:"200px"}},[s("el-row",[s("el-col",{attrs:{span:24}},[s("el-menu",{attrs:{"default-active":"1",collapse:e.isCollapse,"collapse-transition":!1,"background-color":"#2a3542","text-color":"#909399","active-text-color":"#fff"},on:{open:e.handleOpen,close:e.handleClose}},[s("el-menu-item",{attrs:{index:"1"},on:{click:function(t){return e.toDashboard()}}},[s("span",{attrs:{slot:"title"},slot:"title"},[e._v("Cluster Manage")])]),e._v(" "),s("el-menu-item",{attrs:{index:"3"},on:{click:function(t){return e.toMachineManage()}}},[s("span",{attrs:{slot:"title"},slot:"title"},[e._v("Machine Manage")])]),e._v(" "),e._v(" --\x3e\n             "),e._v(" "),e._v(" --\x3e\n            ")],1)],1)],1)],1),e._v(" "),s("el-main",{staticClass:"main",class:{"main-margin":e.isCollapse},staticStyle:{"margin-left":"200px"}},[s("transition",{attrs:{name:"fade",mode:"out-in"}},[e.active?s("router-view"):e._e()],1)],1)],1),e._v(" "),e.importVisible?s("el-dialog",{attrs:{title:"Import Cluster",visible:e.importVisible,"close-on-click-modal":!1},on:{"update:visible":function(t){e.importVisible=t}}},[s("editCluster",{on:{closeDialog:e.closeDialog}})],1):e._e()],1)},staticRenderFns:[]},x=r("C7Lr")(M,S,!1,function(e){r("y6th")},null,null).exports,P=r("3cXf"),E=r.n(P),U=r("ZMud");r("/BUc"),r("chxV"),r("AYuE"),r("9Veg"),r("rE9p"),r("bH6p"),r("lyAA");var V={components:{codemirror:U.codemirror},props:{cluster:{}},data:function(){return{dbList:[],autoCommandParam:{clusterId:this.cluster.clusterId,count:100},result:"",codemirrorOptions:{mode:"application/json",readOnly:!0,autoRefresh:!0,scrollbarStyle:"null",theme:"xq-light",lineNumbers:!0},queryLoading:!1}},methods:{getDBList:function(e){var t=this,r="/data/getDBList/"+e;he.get(r,null,function(e){var r=e.data;0==r.code?r.data.forEach(function(e){var r=e.database;t.dbList.push({keys:e.keys,database:r.slice(2)})}):v.error(r.message)},function(e){v.error(e)})},queryRedis:function(e){var t=this;this.result="","cluster"==this.cluster.redisMode&&(e.database=0),l(e.database)?v.warning("Please select database"):l(e.key)?v.warning("Please enter redis key"):(this.queryLoading=!0,he.post("/data/query",e,function(e){var r=e.data;if(0==r.code){var s=r.data,i={};i.ttl=s.ttl,i.type=s.type,i.value=s.value,t.result=E()(i,null,2)}else v.error(r.message);t.queryLoading=!1},function(e){t.queryLoading=!1,v.error(e)}))},scanRedis:function(e){var t=this;this.result="","cluster"==this.cluster.redisMode&&(e.database=0),l(e.database)?v.warning("Please select database"):(this.queryLoading=!0,he.post("/data/scan",e,function(e){var r=e.data;0==r.code?r.data.forEach(function(e){t.result+=e+"\n"}):v.error(r.message),t.queryLoading=!1},function(e){t.queryLoading=!1,v.error(e)}))}},mounted:function(){this.getDBList(this.cluster.clusterId),"cluster"==this.cluster.redisMode&&(this.autoCommandParam.database="db0")}},z=r("C7Lr")(V,{render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{directives:[{name:"loading",rawName:"v-loading",value:e.queryLoading,expression:"queryLoading"}],staticClass:"query-wrapper",attrs:{id:"query"}},[r("div",{staticClass:"input-wrapper"},[r("el-input",{staticClass:"input-with-select",attrs:{size:"small",placeholder:"Redis Key",clearable:""},model:{value:e.autoCommandParam.key,callback:function(t){e.$set(e.autoCommandParam,"key","string"==typeof t?t.trim():t)},expression:"autoCommandParam.key"}},[r("el-select",{staticStyle:{width:"50px"},attrs:{slot:"prepend",placeholder:"Select DB"},slot:"prepend",model:{value:e.autoCommandParam.database,callback:function(t){e.$set(e.autoCommandParam,"database",t)},expression:"autoCommandParam.database"}},e._l(e.dbList,function(t){return r("el-option",{key:t.database,attrs:{label:"db"+t.database,value:t.database}},[r("span",{staticStyle:{float:"left"}},[e._v("db"+e._s(t.database))]),e._v(" "),r("span",{staticStyle:{float:"right",color:"#8492a6","font-size":"13px"}},[e._v(e._s(t.keys))])])}),1)],1),e._v(" "),r("el-button",{staticStyle:{"margin-left":"20px"},attrs:{size:"small",type:"primary",icon:"el-icon-search"},on:{click:function(t){return e.queryRedis(e.autoCommandParam)}}},[e._v("Query")]),e._v(" "),r("el-button",{attrs:{size:"small",icon:"el-icon-search"},on:{click:function(t){return e.scanRedis(e.autoCommandParam)}}},[e._v("Scan")])],1),e._v(" "),r("codemirror",{staticClass:"result-wrapper",attrs:{options:e.codemirrorOptions},model:{value:e.result,callback:function(t){e.result=t},expression:"result"}})],1)},staticRenderFns:[]},!1,function(e){r("hq0Z")},"data-v-423bd294",null).exports,R=r("N3gQ"),G=r.n(R),$={components:{query:z,editCluster:k},data:function(){return{clusterList:[],cluster:{},clusterId:0,queryVisible:!1,editClusterId:"",editClusterVisible:!1,deleteClusterVisible:!1,clusterListLoading:!1}},methods:{toMonitor:function(e){this.$router.push({name:"redis-monitor",params:{clusterId:e}})},toManage:function(e){this.$router.push({name:"redis-manage",params:{clusterId:e}})},toAlertManage:function(e){this.$router.push({name:"alert-manage",params:{clusterId:e}})},toInstallation:function(){this.$router.push({name:"installation",params:{groupId:this.currentGroupId}})},handleBeforeUpload:function(e){this.clusterId=e},uploadFiles:function(e){var t=this,r=new FormData;r.append("fileName",e.file),r.append("clusterid",this.clusterId),he.post("/node-manage/importConfig",r,function(e){var r=e.data;0==r.code?t.humpbackImages=r.data:v.error(r.message)},function(e){v.error(e)})},downloadFiles:function(e){var t="/node-manage/exportConfig/"+e;he.get(t,null,function(e){var t=e.data;t=E()(t);var r=new Blob([t],{type:""});G.a.saveAs(r,"config.json")},function(e){v.error(e)})},handleQuery:function(e){this.cluster=e,this.queryVisible=!0},getClusterList:function(e){var t=this,r="/cluster/getClusterList/"+e;this.clusterListLoading=!0,l(e)||he.get(r,null,function(e){var r=e.data;if(0==r.code){var s=r.data;s.forEach(function(e){e.clusterState}),t.clusterList=s}else v.error("Get cluster list failed");t.clusterListLoading=!1},function(e){t.clusterListLoading=!1,v.error(e)})},editCluster:function(e){this.editClusterId=e,this.editClusterVisible=!0},showDeleteCluster:function(e){var t=this;this.clusterList.forEach(function(r){r.clusterId==e&&(t.cluster=r,t.deleteClusterVisible=!0)})},deleteCluster:function(e){var t=this,r={clusterId:e,groupId:this.currentGroupId};he.post("/cluster/deleteCluster",r,function(e){0==e.data.code?(t.cluster={},t.getClusterList(t.currentGroupId),t.deleteClusterVisible=!1):v.error("Delete cluster failed")},function(e){v.error(e)})},closeEditClusterDialog:function(e){this.editClusterVisible=e,this.getClusterList(this.currentGroupId)}},computed:{currentGroupId:function(){return Le.getters.getCurrentGroup.groupId},currentUser:function(){return Le.getters.getUser}},watch:{currentGroupId:function(e){this.getClusterList(e),this.$router.push({name:"dashboard",params:{groupId:e}})}},mounted:function(){var e=this.currentGroupId;this.getClusterList(e),this.userRole=Le.getters.getUserRole}},D=r("C7Lr")($,{render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{directives:[{name:"loading",rawName:"v-loading",value:e.clusterListLoading,expression:"clusterListLoading"}]},[r("label",{attrs:{id:"title"}},[e._v("Clusters:")]),e._v(" "),r("el-button",{attrs:{size:"mini",title:"Add Cluster",type:"success"},on:{click:function(t){return e.toInstallation()}}},[e._v("Add Cluster")]),e._v(" "),r("hr"),e._v(" "),r("el-row",{attrs:{gutter:20}},e._l(e.clusterList,function(t){return r("el-col",{key:t.clusterId,attrs:{xs:24,sm:12,md:12,lg:8,xl:6}},[r("el-card",{staticClass:"box-card",attrs:{shadow:"hover"}},[r("div",{staticClass:"box-card-title",attrs:{slot:"header"},slot:"header"},[r("span",[e._v(e._s(t.clusterName))])]),e._v(" "),r("div",[r("div",{staticClass:"text item"},[e._v("\n            State:\n            "),"HEALTH"==t.clusterState?r("el-tag",{attrs:{size:"mini",type:"success"}},[e._v(e._s(t.clusterState))]):r("el-tag",{attrs:{size:"mini",type:"danger"}},[e._v("unInitSlot")])],1),e._v(" "),r("div",{staticClass:"text item"},[e._v("\n            Version:\n            "),r("el-tag",{attrs:{size:"mini"}},[e._v(e._s(t.redisVersion))])],1),e._v(" "),r("div",{staticClass:"text item"},[e._v("\n            Nodes:\n            "),r("el-tag",{attrs:{size:"mini"}},[e._v(e._s(t.clusterKnownNodes))])],1),e._v(" "),"sentinel"!=t.redisMode?r("div",{staticClass:"text item"},[e._v("\n            Master:\n            "),r("el-tag",{attrs:{size:"mini"}},[e._v(e._s(t.clusterSize))])],1):r("div",{staticClass:"text item"},[e._v("\n            Sentinel OK:\n            "),r("el-tag",{attrs:{size:"mini"}},[e._v(e._s(t.sentinelOk))])],1),e._v(" "),"sentinel"!=t.redisMode?r("div",{staticClass:"text item"},[e._v("\n            Total Momery:\n            "),r("el-tag",{attrs:{size:"mini"}},[e._v(e._s(t.totalUsedMemory)+"MB")])],1):r("div",{staticClass:"text item"},[e._v("\n            Sentinel Masters:\n            "),r("el-tag",{attrs:{size:"mini"}},[e._v(e._s(t.sentinelMasters))])],1),e._v(" "),"cluster"==t.redisMode?r("div",{staticClass:"text item"},[e._v("\n            Slots Assigned(ok/assigned):\n            "),r("el-tag",{attrs:{size:"mini"}},[e._v("\n              "+e._s(t.clusterSlotsOk)+"/"+e._s(t.clusterSlotsAssigned)+"\n            ")])],1):e._e(),e._v(" "),"standalone"==t.redisMode?r("div",{staticClass:"text item"},[e._v("\n            DB Size:\n            "),r("el-tag",{attrs:{size:"mini"}},[e._v(e._s(t.dbSize))])],1):e._e(),e._v(" "),"sentinel"==t.redisMode?r("div",{staticClass:"text item"},[e._v("\n            Master OK:\n            "),r("el-tag",{attrs:{size:"mini"}},[e._v(e._s(t.masterOk))])],1):e._e(),e._v(" "),r("div",{staticClass:"text item"},[e._v("\n            Environment:\n            "),0==t.installationEnvironment?r("el-tag",{attrs:{size:"mini"}},[e._v("Docker")]):1==t.installationEnvironment?r("el-tag",{attrs:{size:"mini"}},[e._v("Machine")]):3==t.installationEnvironment?r("el-tag",{attrs:{size:"mini"}},[e._v("Humpback")]):e._e()],1)]),e._v(" "),r("div",{staticClass:"card-bottom"},[r("el-button",{attrs:{size:"mini",title:"Monitor",type:"primary"},on:{click:function(r){return e.toMonitor(t.clusterId)}}},[e._v("Monitor")]),e._v(" "),e.currentUser.userRole<2?r("el-button",{attrs:{size:"mini",title:"Manage",type:"success"},on:{click:function(r){return e.toManage(t.clusterId)}}},[e._v("Manage")]):e._e(),e._v(" "),r("el-button",{attrs:{size:"mini",title:"Manage",type:"danger"},on:{click:function(r){return e.showDeleteCluster(t.clusterId)}}},[e._v("delete")]),e._v(" "),e.currentUser.userRole<2?r("el-dropdown",{staticClass:"more-operation",attrs:{id:"dropdown",trigger:"click"}},[r("el-button",{attrs:{size:"mini",title:"Edit or delete",type:"info",icon:"el-icon-more",circle:""}}),e._v(" "),r("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[r("el-button",{attrs:{size:"mini",title:"下载配置"},on:{click:function(r){return e.downloadFiles(t.clusterId)}}},[e._v("export config")]),e._v(" "),r("el-upload",{attrs:{id:"upload",action:"","http-request":e.uploadFiles,"before-upload":e.handleBeforeUpload(t.clusterId),multiple:!1}},[r("el-button",{attrs:{size:"mini"}},[e._v("import config")])],1)],1)],1):e._e()],1)])],1)}),1),e._v(" "),e.queryVisible?r("el-dialog",{attrs:{title:"Query "+e.cluster.clusterName,visible:e.queryVisible,"close-on-click-modal":!1,width:"50%"},on:{"update:visible":function(t){e.queryVisible=t}}},[r("query",{attrs:{cluster:e.cluster}})],1):e._e(),e._v(" "),e.editClusterVisible?r("el-dialog",{attrs:{title:"Edit Cluster",visible:e.editClusterVisible,"close-on-click-modal":!1},on:{"update:visible":function(t){e.editClusterVisible=t}}},[r("editCluster",{attrs:{clusterId:e.editClusterId},on:{closeDialog:e.closeEditClusterDialog}})],1):e._e(),e._v(" "),r("el-dialog",{attrs:{title:"Delete Cluster",visible:e.deleteClusterVisible,width:"30%"},on:{"update:visible":function(t){e.deleteClusterVisible=t}}},[r("span",[e._v("\n      Are you sure to delete\n      "),r("b",[e._v(e._s(e.cluster.clusterName))]),e._v(" ?\n    ")]),e._v(" "),r("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{size:"small"},on:{click:function(t){e.dialogVisible=!1}}},[e._v("Cancel")]),e._v(" "),r("el-button",{attrs:{size:"small",type:"danger"},on:{click:function(t){return e.deleteCluster(e.cluster.clusterId)}}},[e._v("Delete")])],1)])],1)},staticRenderFns:[]},!1,function(e){r("Z2Em")},"data-v-1083bbb0",null).exports,T=r("a3Yh"),A=r.n(T),O=(r("T9o6"),{props:{sentinelMaster:{}},data:function(){return{infoList:[],search:""}},methods:{getSentinelMasterInfo:function(){var e=this;he.post("/sentinel/getSentinelMasterInfo",this.sentinelMaster,function(t){var r=t.data;0==r.code?e.infoList=r.data:v.error("Get sentinel master info failed")},function(e){v.error(e)})}},mounted:function(){this.getSentinelMasterInfo()}}),q=r("C7Lr")(O,{render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"info-wrapper"},e._l(e.infoList,function(t){return r("div",{key:t.key,staticClass:"info-item"},[r("span",[r("span",{staticClass:"key"},[e._v(e._s(t.key)+":")]),e._v(" "),r("span",{staticClass:"value"},[e._v(e._s(t.value))])])])}),0)},staticRenderFns:[]},!1,function(e){r("PVIw")},"data-v-773ce27a",null).exports,F=r("F8lt"),H=r("gytX");r("4Tad"),r("vCSl"),r("uFka"),r("9Wka"),r("EaeP");var B={props:{nodeInfoParam:{},infoItem:""},data:function(){return{echartsData:[],echartsItemDataxAxis:[],noNodeInfoData:!0,lineColor:["#3888fa","#FF005A","#ffb980","#40c9c6","#b6a2de","#d87a80","#34bfa3","#5ab1ef","#3888fa","#ffba00","#c9c0cb","#FF005A","#3888fa","#FF005A","#ffb980","#40c9c6"],areaStyleColor:["rgba(56, 136, 250, 0.1)","rgba(250, 0, 90, 0.1)","rgba(64, 201, 198, 0.1)","rgba(255, 185, 128, 0.1)"],monitorDataLoading:!1}},methods:{initCharts:function(e){this.buildEchartsData(e);var t=this.buildSeries(this.echartsData),r=F();if((new Date).getTime(),!l(this)){var s=document.getElementById(this.infoItem);if(!l(s)){var i=H.init(s);i.clear(),i=H.init(s);var a=this.infoItem;"used_memory"!=a&&"used_memory_rss"!=a&&"used_memory_overhead"!=a&&"used_memory_dataset"!=a||(a+="(MB)"),i.setOption({title:{text:a,left:35},legend:{type:"scroll",bottom:0},grid:{left:20,right:20,bottom:50,top:50,containLabel:!0},tooltip:{trigger:"axis",axisPointer:{type:"cross"},padding:[5,10],position:function(e,t,r,s,i){var a={top:-10};return a[["left","right"][+(e[0]<i.viewSize[0]/2)]]=5,a}},toolbox:{feature:{saveAsImage:{}}},xAxis:{data:this.echartsItemDataxAxis},yAxis:{axisTick:{show:!0}},series:t}),r.listenTo(document.getElementById(this.infoItem),function(e){setTimeout(function(){i.resize()},0)}),window.addEventListener("resize",function(){setTimeout(function(){i.resize()},0)})}}},getNodeInfoDataList:function(e){var t=this;this.monitorDataLoading=!0,he.post("/monitor/getInfoItemMonitorData",e,function(e){var r=e.data;if(0==r.code){var s=r.data;t.noNodeInfoData=!1,t.initCharts(s)}else v.error("Get node info list failed");t.monitorDataLoading=!1},function(e){t.monitorDataLoading=!1,v.error(e)})},buildSeries:function(e){var t=e.length;if(0!=t){for(var r=[],s=0;s<t;s++){var i=this.lineColor[s%t],a=(this.areaStyleColor[s%t],e[s]);r.push({name:a.name,itemStyle:{normal:{color:i,lineStyle:{color:i,width:1.5}}},smooth:!0,type:"bar",data:a.data,animationDuration:2800,animationEasing:"cubicInOut",symbol:"none"})}return r}},buildEchartsData:function(e){var t=this;this.echartsData=[],this.echartsItemDataxAxis=[];var r=this.infoItem;e.forEach(function(e){var s=e[0],i={name:s.node+" "+s.role.toLowerCase(),data:[]},a=0==t.echartsItemDataxAxis.length;e.forEach(function(e){var s,n,o,l,u,c;for(var d in a&&t.echartsItemDataxAxis.push((s=e.updateTime,o=(n=new Date(s)).getMonth()+1,l=n.getDate(),u=n.getHours(),c=n.getMinutes(),C(o)+"/"+C(l)+" "+C(u)+":"+C(c))),e)r.replace(/[^a-zA-Z]/g,"",/\s/g,"",/[0-9]/g,"").toLowerCase()==d.toLowerCase()&&i.data.push(e[d])}),t.echartsData.push(i)})}},watch:{nodeInfoParam:{handler:function(){var e=JSON.parse(E()(this.nodeInfoParam));e.infoItem=this.infoItem,this.getNodeInfoDataList(e)},deep:!0}}},K=r("C7Lr")(B,{render:function(){var e=this.$createElement,t=this._self._c||e;return t("el-col",{directives:[{name:"loading",rawName:"v-loading",value:this.monitorDataLoading,expression:"monitorDataLoading"}],staticClass:"chart-item",attrs:{xl:12,lg:12,md:24,sm:24}},[t("el-card",{staticClass:"box-card",attrs:{shadow:"hover"}},[t("div",{staticClass:"chart",class:{"chart-no-data":this.noNodeInfoData},attrs:{id:this.infoItem}})])],1)},staticRenderFns:[]},!1,function(e){r("3FC4")},"data-v-17c72376",null).exports;r("F8lt"),r("gytX"),r("4Tad"),r("uFka"),r("9Wka"),r("EaeP");var j={components:{query:z,echartsItem:K,sentinelMasterInfo:q},data:function(){var e;return e={queryVisible:!1,cluster:{},redisNodeList:[],slowLogRedisNodeList:[],timeTypeList:[{value:0,label:"Minute"},{value:1,label:"Hour"}],pickerOptions:{shortcuts:[{text:"Last 15 Min",onClick:function(e){var t=new Date,r=new Date;r.setTime(r.getTime()-9e5),e.$emit("pick",[r,t])}},{text:"Last 30 Min",onClick:function(e){var t=new Date,r=new Date;r.setTime(r.getTime()-18e5),e.$emit("pick",[r,t])}},{text:"Last 1 Hour",onClick:function(e){var t=new Date,r=new Date;r.setTime(r.getTime()-36e5),e.$emit("pick",[r,t])}},{text:"Last 3 Hours",onClick:function(e){var t=new Date,r=new Date;r.setTime(r.getTime()-108e5),e.$emit("pick",[r,t])}},{text:"Last 6 Hours",onClick:function(e){var t=new Date,r=new Date;r.setTime(r.getTime()-216e5),e.$emit("pick",[r,t])}},{text:"Last 12 Hours",onClick:function(e){var t=new Date,r=new Date;r.setTime(r.getTime()-432e5),e.$emit("pick",[r,t])}},{text:"Last 1 Day",onClick:function(e){var t=new Date,r=new Date;r.setTime(r.getTime()-864e5),e.$emit("pick",[r,t])}},{text:"Last 2 Days",onClick:function(e){var t=new Date,r=new Date;r.setTime(r.getTime()-1728e5),e.$emit("pick",[r,t])}},{text:"Last 3 Days",onClick:function(e){var t=new Date,r=new Date;r.setTime(r.getTime()-2592e5),e.$emit("pick",[r,t])}},{text:"Last Week",onClick:function(e){var t=new Date,r=new Date;r.setTime(r.getTime()-6048e5),e.$emit("pick",[r,t])}},{text:"Last Mooth",onClick:function(e){var t=new Date,r=new Date;r.setTime(r.getTime()-2592e6),e.$emit("pick",[r,t])}}]},infoItemList:["used_memory","used_memory_rss","used_memory_overhead","used_memory_dataset","mem_fragmentation_ratio","connections_received","rejected_connections","connected_clients","blocked_clients","commands_processed","instantaneous_ops_per_sec","sync_full","sync_partial_ok","sync_partial_err","keyspace_hits_ratio","keys","expires","cpu_sys","cpu_user"],selectedInfoItemList:["used_memory","connected_clients","commands_processed","keys"],nodeInfoParam:{nodeList:[],timeType:0,timeRange:[new Date-9e5,new Date]},nodeType:"",nodes:[],slowLogVisible:!1,slowLogList:[],timer:0,slowLogParam:{}},A()(e,"slowLogList",[]),A()(e,"clusterLoading",!1),A()(e,"slowLogLoading",!1),A()(e,"conditionSelectedLoading",!1),A()(e,"isSentinelMode",!1),A()(e,"sentinelMasterList",[]),A()(e,"sentinelMaster",{}),A()(e,"sentinelMasterInfoVisible",!1),e},methods:{handleQuery:function(e){this.queryVisible=!0},pickerDateTime:function(){var e=this.nodeInfoParam.timeRange,t=e[0],r=e[1];this.nodeInfoParam.startTime=t,this.nodeInfoParam.endTime=r},getAllNodeList:function(e){var t=this,r="/node-manage/getAllNodeList/"+e;this.slowLogRedisNodeList.push({label:"All"}),he.get(r,null,function(e){var r=e.data;if(0==r.code){var s=[];r.data.forEach(function(e){var r=e.host+":"+e.port,i=e.nodeRole.toLowerCase(),a={node:r,role:i,value:r,label:r+" "+i};s.push(a),t.slowLogRedisNodeList.push(a)}),t.redisNodeList=s,t.nodeType="ALL_MASTER"}else v.error(r.message)},function(e){v.error(e)})},timedRefresh:function(){var e=this;this.timer?clearInterval(this.timer):this.timer=setInterval(function(){e.refresh()},3e3)},refresh:function(){var e=this.nodeInfoParam,t=e.timeRange,r=t[1]-t[0];e.timeRange=[new Date-r,new Date],e.startTime=new Date-r,e.endTime=new Date,this.nodeInfoParam=e},getSlowLogList:function(e){var t=this;this.slowLogLoading=!0,he.post("/monitor/getSlowLogList",e,function(e){var r=e.data;if(0==r.code){var s=r.data;s.forEach(function(e){e.dateTime=L(e.dateTime)}),t.slowLogList=s}else v.error(r.message);t.slowLogLoading=!1},function(e){t.slowLogLoading=!1,v.error(e)})},monitorItemChange:function(e){var t=this;setTimeout(function(){t.refresh()},300)},getSentinelMasterList:function(e){var t=this,r="/sentinel/getSentinelMasterList/"+e;he.get(r,null,function(e){var r=e.data;0==r.code&&(t.sentinelMasterList=r.data)},function(e){v.error(e)})}},watch:{nodes:{handler:function(){var e=this.nodeInfoParam,t=[];this.nodes.length>0&&(this.nodes.forEach(function(e){t.push(e)}),e.nodeList=t,this.nodeInfoParam=e)}},nodeType:{handler:function(){if("NODE"!=this.nodeType){var e=this.nodeInfoParam,t=[];"ALL_MASTER"==this.nodeType&&this.redisNodeList.forEach(function(e){"master"==e.role&&t.push(e.node)}),"ALL_MASTER"!=this.nodeType&&"ALL"!=this.nodeType||(this.nodes=[]),e.nodeList=t,this.nodeInfoParam=e}else this.nodes=[]}},slowLogParam:{handler:function(){this.getSlowLogList(this.slowLogParam)},deep:!0}},mounted:function(){var e=this,t=this.$route.params.clusterId;I(t,function(r){if(e.cluster=r,parseInt(r.redisVersion.substring(0))<4)for(var s=0;s<e.selectedInfoItemList.length;s++){var i=e.selectedInfoItemList[s];"used_memory_overhead"!=i&&"used_memory_dataset"!=i||e.selectedInfoItemList.splice(s,s)}e.getAllNodeList(e.cluster.clusterId),e.nodeInfoParam.clusterId=t,e.slowLogParam.clusterId=t,e.pickerDateTime(),e.timedRefresh(),e.isSentinelMode="sentinel"==r.redisMode,e.isSentinelMode&&(e.getSentinelMasterList(t),e.infoItemList=["connections_received","rejected_connections","connected_clients","blocked_clients","commands_processed","instantaneous_ops_per_sec","cpu_sys","cpu_user"],e.selectedInfoItemList=e.infoItemList)})},destroyed:function(){clearInterval(this.timer)}},W=r("C7Lr")(j,{render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{attrs:{id:"monitor"}},[e.isSentinelMode?r("div",{directives:[{name:"loading",rawName:"v-loading",value:e.clusterLoading,expression:"clusterLoading"}],staticClass:"body-wrapper",staticStyle:{"margin-top":"20px"}},[r("div",{staticClass:"base-info-wrapper"},[r("el-table",{attrs:{data:e.sentinelMasterList}},[r("el-table-column",{attrs:{property:"name",label:"Master Name"}}),e._v(" "),r("el-table-column",{attrs:{property:"status",label:"Status"},scopedSlots:e._u([{key:"default",fn:function(t){return["ok"==t.row.status?r("el-tag",{attrs:{size:"mini"}},[e._v(e._s(t.row.status))]):r("el-tag",{attrs:{size:"mini",type:"danger"}},[e._v(e._s(t.row.status))])]}}],null,!1,1725191865)}),e._v(" "),r("el-table-column",{attrs:{property:"flags",label:"Flags"},scopedSlots:e._u([{key:"default",fn:function(t){return["master"==t.row.flags?r("el-tag",{attrs:{size:"mini"}},[e._v(e._s(t.row.flags))]):r("el-tag",{attrs:{size:"mini",type:"danger"}},[e._v(e._s(t.row.flags))])]}}],null,!1,1275231818)}),e._v(" "),r("el-table-column",{attrs:{prop:"monitor",label:"Monitor",align:"center",sortable:""},scopedSlots:e._u([{key:"default",fn:function(e){return[e.row.monitor?r("i",{staticClass:"el-icon-success status-icon normal-status"}):r("i",{staticClass:"el-icon-error status-icon normal-bad"})]}}],null,!1,1044783768)}),e._v(" "),r("el-table-column",{attrs:{label:"Master Node"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.host)+":"+e._s(t.row.port))]}}],null,!1,2675805811)}),e._v(" "),r("el-table-column",{attrs:{property:"lastMasterNode",label:"Last Master Node"}}),e._v(" "),r("el-table-column",{attrs:{property:"numSlaves",label:"Num Slaves"}}),e._v(" "),r("el-table-column",{attrs:{property:"sentinels",label:"Sentinels"}}),e._v(" "),r("el-table-column",{attrs:{label:"Detail"},scopedSlots:e._u([{key:"default",fn:function(t){return r("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(r){e.sentinelMasterInfoVisible=!0,e.sentinelMaster=t.row}}},[e._v("Detail")])}}],null,!1,3640876897)})],1)],1)]):e._e(),e._v(" "),r("div",{staticStyle:{"margin-top":"20px"}},[r("div",{staticClass:"monitor-condition-wrapper"},[r("div",{staticClass:"condition-wrapper"},[r("el-select",{staticClass:"condition-item",staticStyle:{width:"120px"},attrs:{size:"small",placeholder:"Node Type"},model:{value:e.nodeType,callback:function(t){e.nodeType=t},expression:"nodeType"}},[r("el-option",{attrs:{label:"All Master",value:"ALL_MASTER"}}),e._v(" "),r("el-option",{attrs:{label:"All",value:"ALL"}}),e._v(" "),r("el-option",{attrs:{label:"Node",value:"NODE"}})],1),e._v(" "),"NODE"==e.nodeType?r("el-select",{staticClass:"condition-item",staticStyle:{"min-width":"280px"},attrs:{filterable:"",size:"small",placeholder:"Node",multiple:"","collapse-tags":"",clearable:""},model:{value:e.nodes,callback:function(t){e.nodes=t},expression:"nodes"}},e._l(e.redisNodeList,function(e){return r("el-option",{key:e.label,attrs:{label:e.label,value:e.value}})}),1):e._e(),e._v(" "),r("el-select",{staticClass:"condition-item",staticStyle:{width:"100px"},attrs:{size:"small",placeholder:"Time Type"},model:{value:e.nodeInfoParam.timeType,callback:function(t){e.$set(e.nodeInfoParam,"timeType",t)},expression:"nodeInfoParam.timeType"}},e._l(e.timeTypeList,function(e){return r("el-option",{key:e.label,attrs:{label:e.label,value:e.value}})}),1),e._v(" "),r("el-select",{staticClass:"condition-item",staticStyle:{width:"260px"},attrs:{size:"small",placeholder:"Info Item",multiple:"","collapse-tags":""},on:{change:e.monitorItemChange},model:{value:e.selectedInfoItemList,callback:function(t){e.selectedInfoItemList=t},expression:"selectedInfoItemList"}},e._l(e.infoItemList,function(e){return r("el-option",{key:e,attrs:{label:e,value:e}})}),1),e._v(" "),r("div",{staticClass:"time-picker-wrapper"},[r("el-date-picker",{attrs:{width:"1080px",size:"small",type:"datetimerange","picker-options":e.pickerOptions,"range-separator":"-","start-placeholder":"Start Time","end-placeholder":"End Time",align:"right",editable:!1,"value-format":"timestamp"},on:{change:e.pickerDateTime},model:{value:e.nodeInfoParam.timeRange,callback:function(t){e.$set(e.nodeInfoParam,"timeRange",t)},expression:"nodeInfoParam.timeRange"}})],1)],1),e._v(" "),r("i",{staticClass:"el-icon-refresh-left refresh",on:{click:function(t){return e.refresh()}}})]),e._v(" "),r("el-row",{staticClass:"echart-wrapper",attrs:{id:"monitor-charts"}},e._l(e.selectedInfoItemList,function(t){return r("echartsItem",{key:t,attrs:{infoItem:t,nodeInfoParam:e.nodeInfoParam}})}),1)],1),e._v(" "),r("el-dialog",{attrs:{title:"Query",visible:e.queryVisible,"close-on-click-modal":!1,width:"60%"},on:{"update:visible":function(t){e.queryVisible=t}}},[r("query",{attrs:{cluster:e.cluster}})],1),e._v(" "),r("el-dialog",{attrs:{title:"Slow Log",visible:e.slowLogVisible,"close-on-click-modal":!1,width:"80%"},on:{"update:visible":function(t){e.slowLogVisible=t}}},[r("div",{directives:[{name:"loading",rawName:"v-loading",value:e.slowLogLoading,expression:"slowLogLoading"}]},[r("el-select",{staticClass:"condition-item",staticStyle:{"margin-bottom":"20px"},attrs:{filterable:"",size:"small",placeholder:"Please select node"},model:{value:e.slowLogParam.node,callback:function(t){e.$set(e.slowLogParam,"node",t)},expression:"slowLogParam.node"}},e._l(e.slowLogRedisNodeList,function(e){return r("el-option",{key:e.label,attrs:{label:e.label,value:e.value}})}),1),e._v(" "),r("el-table",{attrs:{data:e.slowLogList,"default-sort":{prop:"dateTime",order:"descending"}}},[r("el-table-column",{attrs:{type:"index",width:"50"}}),e._v(" "),r("el-table-column",{attrs:{prop:"node",label:"Node",sortable:""}}),e._v(" "),r("el-table-column",{attrs:{prop:"type",label:"Type"}}),e._v(" "),r("el-table-column",{attrs:{prop:"command",label:"Command"}}),e._v(" "),r("el-table-column",{attrs:{prop:"executionTime",label:"Execution Time(μs)",sortable:""}}),e._v(" "),r("el-table-column",{attrs:{prop:"dateTime",label:"Date Time",sortable:""}})],1)],1)]),e._v(" "),e.sentinelMasterInfoVisible?r("el-dialog",{attrs:{title:"Sentinel Master Info",visible:e.sentinelMasterInfoVisible,"close-on-click-modal":!1,width:"40%"},on:{"update:visible":function(t){e.sentinelMasterInfoVisible=t}}},[r("sentinelMasterInfo",{attrs:{sentinelMaster:e.sentinelMaster}})],1):e._e()],1)},staticRenderFns:[]},!1,function(e){r("0Cx0")},"data-v-2abe62bf",null).exports,Z=r("4Xi4"),Q=r.n(Z),X={props:{redisNode:{}},data:function(){return{infoList:[],search:""}},methods:{getNodeInfo:function(){var e=this;he.post("/node-manage/getNodeInfo",this.redisNode,function(t){var r=t.data;0==r.code?e.infoList=r.data:v.error("Get node info failed")},function(e){v.error(e)})}},computed:{filterInfoList:function(){var e=this;return this.infoList.filter(function(t){return!e.search||t.key.toLowerCase().includes(e.search.toLowerCase())})}},mounted:function(){this.getNodeInfo()}},Y={props:{redisNode:{}},data:function(){return{configList:[],search:""}},methods:{getConfig:function(){var e=this;he.post("/node-manage/getConfig",this.redisNode,function(t){var r=t.data;0==r.code?e.configList=r.data:v.error("get node config failed")},function(e){v.error(e)})}},computed:{filterConfigList:function(){var e=this;return this.configList.filter(function(t){return!e.search||t.key.toLowerCase().includes(e.search.toLowerCase())})}},mounted:function(){this.getConfig()}},J={props:{sentinelMaster:{}},data:function(){return{infoList:[],search:""}},methods:{getSentinelMasterInfo:function(){var e=this;he.post("/sentinel/getSentinelMasterSlaves",this.sentinelMaster,function(t){var r=t.data;0==r.code?e.infoList=r.data:v.error("Get sentinel master slaves failed")},function(e){v.error(e)})}},mounted:function(){this.getSentinelMasterInfo()}},ee={components:{info:r("C7Lr")(X,{render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"info-wrapper"},[r("el-input",{staticStyle:{"margin-bottom":"20px"},attrs:{size:"mini",placeholder:"search"},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}}),e._v(" "),e._l(e.filterInfoList,function(t){return r("div",{key:t.key,staticClass:"info-item"},[null!=t.description?r("div",{staticClass:"description"},[e._v("# "+e._s(t.description))]):e._e(),e._v(" "),r("span",[r("span",{staticClass:"key"},[e._v(e._s(t.key)+":")]),e._v(" "),r("span",{staticClass:"value"},[e._v(e._s(t.value))])])])})],2)},staticRenderFns:[]},!1,function(e){r("XY94")},"data-v-58cfa0c0",null).exports,config:r("C7Lr")(Y,{render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"config-wrapper"},[r("el-input",{staticStyle:{"margin-bottom":"20px"},attrs:{size:"mini",placeholder:"search"},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}}),e._v(" "),e._l(e.filterConfigList,function(t){return r("div",{key:t.key,staticClass:"config-item"},[null!=t.description&&""!=t.description?r("div",{staticClass:"description"},[e._v("# "+e._s(t.description))]):e._e(),e._v(" "),r("span",[r("span",{staticClass:"key"},[e._v(e._s(t.key)+":")]),e._v(" "),r("span",{staticClass:"value"},[e._v(e._s(t.value))])])])})],2)},staticRenderFns:[]},!1,function(e){r("bfE2")},"data-v-4df1dbcc",null).exports,sentinelMasterInfo:q,sentinelMasterSlaves:r("C7Lr")(J,{render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"info-wrapper"},e._l(e.infoList,function(t){return r("div",{key:t.key,staticClass:"info-item"},[r("span",[r("span",{staticClass:"key"},[e._v(e._s(t.key)+":")]),e._v(" "),r("span",{staticClass:"value"},[e._v(e._s(t.value))])])])}),0)},staticRenderFns:[]},!1,function(e){r("02K+")},"data-v-418e69ac",null).exports},data:function(){var e=this,t=function(e,t,r){Q()(t)?(t<0||t>16383)&&r(new Error("Slot range between 0 and 16383")):r(new Error("Please enter number")),r()};return{cluster:{},search:"",redisNodeList:[],replicateOfVisible:!1,failOverVisible:!1,importNodeVisible:!1,editConfigVisible:!1,forgetVisible:!1,moveSlotVisible:!1,startNodeVisible:!1,stopNodeVisible:!1,restartNodeVisible:!1,deleteNodeVisible:!1,infoVisible:!1,configVisible:!1,initSlotsVisible:!1,slotRange:{},operationNode:{},operationNodeList:[],newRedisNode:{},configKeyList:[],redisConfig:{},nodeConfigList:[],rules:{redisNode:[{required:!0,message:"Please enter redis node",trigger:"blur"},{required:!0,validator:function(e,t,r){if(!d(t))return r(new Error("Incorrect format"));r()},trigger:"blur"},{required:!0,validator:function(t,r,s){var i={redisPassword:"sentinel"!=e.cluster.redisMode?e.cluster.redisPassword:e.sentinelMaster.authPass},a=r.split(":"),n={host:a[0],port:a[1]};i.redisNode=n,he.post("/validate/redisNode",i,function(e){if(0!=e.data.code)return s(new Error("Connection refused."));s()},function(e){return s(new Error("Network error, "+e))})},trigger:"blur"}],startSlot:[{required:!0,message:"Please enter slot",trigger:"blur"},{required:!0,validator:t,trigger:"blur"}],endSlot:[{required:!0,message:"Please enter slot",trigger:"blur"},{required:!0,validator:t,trigger:"blur"},{required:!0,validator:function(t,r,s){var i=e.slotRange.startSlot;l(i)&&s(),r-i<0&&s(new Error("End slot must be greater than the start slot")),s()},trigger:"blur"}],configKey:[{required:!0,message:"Please select or enter config key",trigger:"blur"}],name:[{required:!0,message:"Please enter master name",trigger:"blur"},{required:!0,validator:function(t,r,s){if(e.isUpdateSentinelMaster)return s();var i={clusterId:e.cluster.clusterId,groupId:e.cluster.groupId,name:r};he.post("/sentinel/getSentinelMasterByName",i,function(e){if(0==e.data.code)return s(new Error("Master name has been exist."));s()},function(e){return s(new Error("Network error, "+e))})},trigger:"blur"}],downAfterMilliseconds:[{type:"number",message:"Please enter integer",trigger:"blur"}],parallelSyncs:[{type:"number",message:"Please enter integer",trigger:"blur"}],failoverTimeout:[{type:"number",message:"Please enter integer",trigger:"blur"}],quorum:[{required:!0,message:"Please enter quorum",trigger:"blur"},{type:"number",message:"Please enter integer",trigger:"blur"}]},clusterLoading:!1,nodeListLoading:!1,operationLoading:!1,sentinelMasterList:[],sentinelMaster:{},sentinelMasterInfoVisible:!1,sentinelMasterEditVisible:!1,isUpdateSentinelMaster:!1,deleteSentinelMasterVisible:!1,failoverSentinelMasterVisible:!1,sentinelMasterSlavesVisible:!1}},methods:{tableRowClassName:function(e){var t=e.row;return e.rowIndex,"MASTER"==t.nodeRole?"info-row":""},handleSelectionChange:function(e){var t=this;this.operationNode=[],e.forEach(function(e){t.operationNode.push(e)})},getAllNodeList:function(e){var t=this;this.nodeListLoading=!0;var r="/node-manage/getAllNodeListWithStatus/"+e;he.get(r,null,function(e){var r=e.data;if(0==r.code){var s=[],i=void 0,a=[];r.data.forEach(function(e){l(e.nodeId)&&(e.nodeId=e.host+":"+e.port);var t=e.flags;e.time=L(e.updateTime),"master"==t?(a=[],(i=e).children=a,s.push(i)):"slave"==t||"replica"==t?e.runStatus?a.push(e):(e.children=[],s.push(e)):s.push(e)}),s.forEach(function(e){var t=e.children,r=0;l(t)||l(t.length)||(r=t.length),e.replicaNumber=r}),t.redisNodeList=s}else v.error(r.message);t.nodeListLoading=!1},function(e){t.nodeListLoading=!1,v.error(e)})},reload:function(){var e=this,t=this.cluster.clusterId;this.getAllNodeList(t),I(t,function(r){e.cluster=r,e.getAllNodeList(t),e.getConfigKeyList()}),this.updateCluster(this.clsuter)},updateCluster:function(e){var t=this;he.post("/cluster/updateCluster",this.cluster,function(e){var r=e.data;0==r.code?t.cluster=r.data:v.error(r.message)},function(e){v.error(e)})},getNodeInfo:function(e){this.operationNode=e,this.infoVisible=!0},getConfig:function(e){this.operationNode=e,this.configVisible=!0},getConfigKeyList:function(){var e=this;he.get("/node-manage/getRedisConfigKeyList",null,function(t){e.configKeyList=t.data.data},function(e){v.error(e)})},getConfigCurrentValue:function(e){var t=this,r={cluster:this.cluster,configKey:e.configKey};he.post("/node-manage/getConfigCurrentValue",r,function(e){t.nodeConfigList=e.data.data},function(e){v.error(e)})},editConfig:function(e){var t=this;this.$refs[e].validate(function(e){if(e){var r={clusterId:t.cluster.clusterId,redisConfig:t.redisConfig,groupId:t.currentGroup.groupId};he.post("/node-manage/updateRedisConfig",r,function(e){0==e.data.code?t.editConfigVisible=!1:v.error("update config failed")},function(e){v.error(e)})}})},canOperate:function(){if(this.nodeNumber<=1)return!0;var e=this.cluster.nodes,t=e.split(",");return this.operationNodeList.forEach(function(r){var s=r.host+":"+r.port;if(e.indexOf(s)>-1&&1==t.length)return v.warning("I can't operate "+s+", because it in the database"),!1}),!0},buildNodeList:function(e){var t=!l(e.length);this.operationNodeList=[],t||(this.operationNode={},this.operationNode=e,this.operationNode.groupId=this.currentGroup.groupId,this.operationNodeList.push(this.operationNode))},handleReplicateOf:function(e){this.replicateOfVisible=!0,this.buildNodeList(e)},replicateOf:function(e){var t=this;if(l(e))v.error("Node invalid");else{this.operationNodeList.forEach(function(t){t.masterId=e});var r=this.cluster.redisMode,s=void 0;if("cluster"==r)s="/node-manage/replicateOf";else{if("standalone"!=r)return;s="/node-manage/standaloneReplicateOf"}he.post(s,this.operationNodeList,function(e){var r=e.data;t.reload(),0==r.code?t.replicateOfVisible=!1:v.error(r.message)},function(e){v.error(e)})}},handleFailOver:function(e){this.failOverVisible=!0,this.buildNodeList(e)},failOver:function(){var e=this;he.post("/node-manage/failOver",this.operationNodeList,function(t){var r=t.data;e.getAllNodeList(e.cluster.clusterId),0==r.code?e.failOverVisible=!1:v.error(r.message)},function(e){v.error(e)})},importNode:function(e){var t=this;this.$refs[e].validate(function(e){if(e){var r=t.newRedisNode.address.split(":"),s={clusterId:t.cluster.clusterId,host:r[0],port:r[1],groupId:t.currentGroup.groupId},i=[];i.push(s),he.post("/node-manage/importNode",i,function(e){var r=e.data;t.reload(),0==r.code?t.importNodeVisible=!1:v.error(r.message)},function(e){v.error(e)})}})},handleForget:function(e){this.forgetVisible=!0,this.buildNodeList(e)},forget:function(){var e=this,t=this.cluster.redisMode,r=void 0;if("cluster"==t)r="/node-manage/forget";else{if("standalone"!=t)return;r="/node-manage/standaloneForget"}this.canOperate()&&he.post(r,this.operationNodeList,function(t){var r=t.data;e.reload(),0==r.code?e.forgetVisible=!1:v.error(r.message)},function(e){v.error(e)})},handleMoveSlot:function(e){this.moveSlotVisible=!0,this.buildNodeList(e)},moveSlot:function(e){var t=this;this.$refs[e].validate(function(r){if(r){var s={redisNode:t.operationNode,slotRange:t.slotRange,groupId:t.currentGroup.groupId};he.post("/node-manage/moveSlot",s,function(r){var s=r.data;t.getAllNodeList(t.cluster.clusterId),0==s.code?(t.moveSlotVisible=!1,t.$refs[e].resetFields()):v.error(s.message+" Move slot failed")},function(e){v.error(e)})}})},handleStart:function(e){e.runStatus?v.error("This node is already running"):(this.buildNodeList(e),this.startNodeVisible=!0)},startNode:function(){var e=this;he.post("/node-manage/start",this.operationNodeList,function(t){var r=t.data;e.reload(),0==r.code?e.startNodeVisible=!1:v.error("start node failed")},function(e){v.error(e)})},handleStop:function(e){e.inCluster,e.runStatus?(this.buildNodeList(e),this.stopNodeVisible=!0):v.error("This node has stopped")},stopNode:function(){var e=this;this.canOperate&&he.post("/node-manage/stop",this.operationNodeList,function(t){var r=t.data;e.reload(),0==r.code?e.stopNodeVisible=!1:v.error("stop node failed")},function(e){v.error(e)})},handleRestart:function(e){this.buildNodeList(e),this.restartNodeVisible=!0},restartNode:function(){var e=this;this.canOperate&&he.post("/node-manage/restart",this.operationNodeList,function(t){var r=t.data;e.reload(),0==r.code?e.restartNodeVisible=!1:v.error("restart node failed")},function(e){v.error(e)})},handleDelete:function(e){var t=e.inCluster,r=e.runStatus;t?v.error(e.host+":"+e.port+" still in the cluster, please forget it first"):r?v.error(e.host+":"+e.port+" is running, please stop it first"):(this.buildNodeList(e),this.deleteNodeVisible=!0)},deleteNode:function(){var e=this;this.canOperate&&he.post("/node-manage/delete",this.operationNodeList,function(t){var r=t.data;e.reload(),0==r.code?e.deleteNodeVisible=!1:v.error("delete node failed")},function(e){v.error(e)})},initSlots:function(){var e=this;he.post("/node-manage/initSlots",this.cluster,function(t){var r=t.data;e.reload(),0==r.code?e.initSlotsVisible=!1:v.error(r.message)},function(e){v.error(e)})},refresh:function(){var e=this,t=this.cluster.clusterId;I(t,function(r){e.cluster=r,e.getAllNodeList(t)})},getSentinelMasterList:function(e){var t=this,r="/sentinel/getSentinelMasterList/"+e;he.get(r,null,function(e){var r=e.data;0==r.code&&(t.sentinelMasterList=r.data)},function(e){v.error(e)})},monitorMaster:function(e){var t=this;this.$refs[e].validate(function(e){if(e){var r=t.sentinelMaster.redisNode.split(":");t.sentinelMaster.host=r[0],t.sentinelMaster.port=r[1],t.sentinelMaster.clusterId=t.cluster.clusterId,t.sentinelMaster.groupId=t.cluster.groupId,he.post("/sentinel/monitorMaster",t.sentinelMaster,function(e){0==e.data.code?t.sentinelMasterEditVisible=!1:v.error("Monitor new master failed."),t.getSentinelMasterList(t.cluster.clusterId)},function(e){v.error(e)})}})},updateSentinelMaster:function(e){var t=this;this.$refs[e].validate(function(e){e&&he.post("/sentinel/updateSentinelMaster",t.sentinelMaster,function(e){0==e.data.code?t.sentinelMasterEditVisible=!1:v.error("Update sentinel master failed."),t.getSentinelMasterList(t.cluster.clusterId)},function(e){v.error(e)})})},editSentinelMaster:function(e){var t=this;this.isUpdateSentinelMaster=!0,this.sentinelMasterEditVisible=!0,he.post("/sentinel/getSentinelMasterByName",e,function(e){var r=e.data;0==r.code?(t.sentinelMaster=r.data,t.sentinelMaster.redisNode=t.sentinelMaster.host+":"+t.sentinelMaster.port):v.error("Get sentinel master failed.")},function(e){v.error(e)})},deleteSentinelMaster:function(){var e=this;he.post("/sentinel/deleteSentinelMaster",this.sentinelMaster,function(t){0==t.data.code?(e.deleteSentinelMasterVisible=!1,e.getSentinelMasterList(e.cluster.clusterId)):v.error("Remove sentinel master failed.")},function(e){v.error(e)})},failoverSentinelMaster:function(){var e=this;he.post("/sentinel/failoverSentinelMaster",this.sentinelMaster,function(t){0==t.data.code?(e.deleteSentinelMasterVisible=!1,e.getSentinelMasterList(e.cluster.clusterId)):v.error("Failover sentinel master failed.")},function(e){v.error(e)})}},computed:{nodeNumber:function(){var e=0;return this.redisNodeList.forEach(function(t){e+=1;var r=t.children;l(r)||l(r.length)||(e+=r.length)}),e},currentGroup:function(){return Le.getters.getCurrentGroup}},watch:{currentGroup:function(e){this.$router.push({name:"dashboard",params:{groupId:e.groupId}})}},mounted:function(){var e=this,t=this.$route.params.clusterId;I(t,function(r){e.cluster=r,e.getAllNodeList(t),e.getConfigKeyList(),"sentinel"==r.redisMode&&e.getSentinelMasterList(t)})}},te=r("C7Lr")(ee,{render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"body-wrapper",attrs:{id:"cluster-manage"}},[r("div",{directives:[{name:"loading",rawName:"v-loading",value:e.clusterLoading,expression:"clusterLoading"}],staticClass:"manage-header-wrapper"},[r("div",{staticClass:"title-wrapper"},[r("span",[e._v(e._s(e.cluster.clusterName))]),e._v(" "),"HEALTH"==e.cluster.clusterState?r("i",{staticClass:"el-icon-sunny health",attrs:{title:"Status"}}):r("i",{staticClass:"el-icon-heavy-rain bad",attrs:{title:"Status"}})]),e._v(" "),r("div",{staticClass:"base-info-operation-wrapper"},[r("span",{staticClass:"base-info-item"},[e._v("\n        Node:\n        "),r("el-tag",{attrs:{size:"mini"}},[e._v(e._s(e.cluster.clusterKnownNodes))])],1),e._v(" "),"sentinel"!=e.cluster.redisMode?r("span",{staticClass:"base-info-item"},[e._v("\n        Master:\n        "),r("el-tag",{attrs:{size:"mini"}},[e._v(e._s(e.cluster.clusterSize))])],1):r("span",{staticClass:"base-info-item"},[e._v("\n        Sentinel OK:\n        "),r("el-tag",{attrs:{size:"mini"}},[e._v(e._s(e.cluster.sentinelOk))])],1),e._v(" "),"sentinel"==e.cluster.redisMode?r("span",{staticClass:"base-info-item"},[e._v("\n        Sentinel Masters:\n        "),r("el-tag",{attrs:{size:"mini"}},[e._v(e._s(e.cluster.sentinelMasters))])],1):e._e(),e._v(" "),"sentinel"==e.cluster.redisMode?r("span",{staticClass:"base-info-item"},[e._v("\n        Master OK:\n        "),r("el-tag",{attrs:{size:"mini"}},[e._v(e._s(e.cluster.masterOk))])],1):e._e(),e._v(" "),r("span",{staticClass:"base-info-item"},[e._v("\n        Environment:\n        "),0==e.cluster.installationEnvironment?r("el-tag",{attrs:{size:"mini"}},[e._v("Docker")]):1==e.cluster.installationEnvironment?r("el-tag",{attrs:{size:"mini"}},[e._v("Machine")]):3==e.cluster.installationEnvironment?r("el-tag",{attrs:{size:"mini"}},[e._v("Humpback")]):e._e()],1),e._v(" "),null!=e.cluster.image&&""!=e.cluster.image?r("span",{staticClass:"base-info-item"},[e._v("\n        Image:\n        "),r("el-tag",{attrs:{size:"mini"}},[e._v(e._s(e.cluster.image))])],1):e._e(),e._v(" "),r("span",{staticClass:"base-info-item"},[e._v("\n        Type:\n        "),0==e.cluster.installationType?r("el-tag",{attrs:{size:"mini"}},[e._v("Redis Manager")]):r("el-tag",{attrs:{size:"mini"}},[e._v("Import")])],1)])]),e._v(" "),e.sentinelMasterList.length>0?r("div",{staticStyle:{"margin-buttom":"20px"}},[r("el-table",{attrs:{data:e.sentinelMasterList}},[r("el-table-column",{attrs:{property:"name",label:"Master Name"}}),e._v(" "),r("el-table-column",{attrs:{property:"status",label:"Status"},scopedSlots:e._u([{key:"default",fn:function(t){return["ok"==t.row.status?r("el-tag",{attrs:{size:"mini"}},[e._v(e._s(t.row.status))]):r("el-tag",{attrs:{size:"mini",type:"danger"}},[e._v(e._s(t.row.status))])]}}],null,!1,1725191865)}),e._v(" "),r("el-table-column",{attrs:{property:"flags",label:"Flags"},scopedSlots:e._u([{key:"default",fn:function(t){return["master"==t.row.flags?r("el-tag",{attrs:{size:"mini"}},[e._v(e._s(t.row.flags))]):r("el-tag",{attrs:{size:"mini",type:"danger"}},[e._v(e._s(t.row.flags))])]}}],null,!1,1275231818)}),e._v(" "),r("el-table-column",{attrs:{prop:"monitor",label:"Monitor",align:"center",sortable:""},scopedSlots:e._u([{key:"default",fn:function(e){return[e.row.monitor?r("i",{staticClass:"el-icon-success status-icon normal-status"}):r("i",{staticClass:"el-icon-error status-icon normal-bad"})]}}],null,!1,1044783768)}),e._v(" "),r("el-table-column",{attrs:{label:"Master Node"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.host)+":"+e._s(t.row.port))]}}],null,!1,2675805811)}),e._v(" "),r("el-table-column",{attrs:{property:"lastMasterNode",label:"Last Master Node"}}),e._v(" "),r("el-table-column",{attrs:{property:"numSlaves",label:"Num Slaves"}}),e._v(" "),r("el-table-column",{attrs:{property:"sentinels",label:"Sentinels"}}),e._v(" "),r("el-table-column",{attrs:{width:"220px"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-dropdown",{attrs:{size:"mini","split-button":"",type:"primary",trigger:"click"}},[e._v("\n            Info\n            "),r("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[r("el-dropdown-item",{nativeOn:{click:function(r){e.sentinelMasterInfoVisible=!0,e.sentinelMaster=t.row}}},[e._v("Detail")]),e._v(" "),r("el-dropdown-item",{nativeOn:{click:function(r){e.sentinelMasterSlavesVisible=!0,e.sentinelMaster=t.row}}},[e._v("Slaves")])],1)],1),e._v(" "),r("el-dropdown",{attrs:{size:"mini","split-button":"",type:"danger",trigger:"click"}},[e._v("\n            Operate\n            "),r("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[r("el-dropdown-item",{nativeOn:{click:function(r){return e.editSentinelMaster(t.row)}}},[e._v("Edit")]),e._v(" "),r("el-dropdown-item",{nativeOn:{click:function(r){e.failoverSentinelMasterVisible=!0,e.sentinelMaster=t.row}}},[e._v("Failover")]),e._v(" "),r("el-dropdown-item",{nativeOn:{click:function(r){e.deleteSentinelMasterVisible=!0,e.sentinelMaster=t.row}}},[e._v("Delete")])],1)],1)]}}],null,!1,1426419818)})],1)],1):e._e(),e._v(" "),r("div",{directives:[{name:"loading",rawName:"v-loading",value:e.nodeListLoading,expression:"nodeListLoading"}],staticClass:"nodes-wrapper"},[r("div",{staticClass:"batch-operation-wrapper"},[r("div",{staticClass:"batch-title"},[e._v("Cluster Operation")]),e._v(" "),r("div",{staticStyle:{display:"flex","justify-content":"space-between"}},["sentinel"!=e.cluster.redisMode?r("div",[r("el-link",{attrs:{underline:!1,icon:"el-icon-edit"},on:{click:function(t){e.editConfigVisible=!0}}},[e._v("Edit Config")]),e._v(" "),"cluster"!=e.cluster.redisMode||e.cluster.initialized||0!=e.cluster.clusterSlotsAssigned?e._e():r("span",[r("el-divider",{attrs:{direction:"vertical"}}),e._v(" "),r("el-link",{attrs:{underline:!1,icon:"el-icon-coordinate"},on:{click:function(t){e.initSlotsVisible=!0}}},[e._v("Init Slot")])],1)],1):e._e(),e._v(" "),r("div"),e._v(" "),r("div",{staticStyle:{display:"flex","align-items":"center"}},["sentinel"!=e.cluster.redisMode?r("el-link",{attrs:{underline:!1,icon:"el-icon-plus",type:"primary"},on:{click:function(t){e.importNodeVisible=!0}}},[e._v("Import Node")]):r("el-link",{attrs:{underline:!1,icon:"el-icon-plus",type:"primary"},on:{click:function(t){e.sentinelMasterEditVisible=!0,e.isUpdateSentinelMaster=!1,e.sentinelMaster={}}}},[e._v("Monitor Master")]),e._v(" "),r("el-divider",{attrs:{direction:"vertical"}}),e._v(" "),r("i",{staticClass:"el-icon-refresh-left refresh",on:{click:function(t){return e.refresh()}}})],1)])]),e._v(" "),r("div",{staticClass:"table-wrapper"},[r("el-table",{staticStyle:{width:"100%","margin-bottom":"10px"},attrs:{data:e.redisNodeList,"row-key":"nodeId",size:"medium","default-sort":{prop:"slotRange",order:"ascending"},"row-class-name":e.tableRowClassName,"tree-props":{children:"children",hasChildren:"hasChildren"},"default-expand-all":!0}},[r("el-table-column",{attrs:{label:"Link State",sortable:"",width:"150px"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n            "+e._s(t.row.slot)+"\n            "),"connected"==t.row.linkState?r("el-tag",{attrs:{size:"mini",type:"success"}},[e._v(e._s(t.row.linkState))]):r("el-tag",{staticClass:"pointer",attrs:{size:"small",type:"warning"}},[e._v(e._s(t.row.linkState))])]}}])}),e._v(" "),r("el-table-column",{attrs:{label:"Flags",width:"90px"},scopedSlots:e._u([{key:"default",fn:function(t){return["master"==t.row.flags?r("el-tag",{attrs:{size:"mini"}},[e._v("\n              "+e._s(t.row.flags)+"\n              "),t.row.replicaNumber>0?r("span",[e._v("["+e._s(t.row.replicaNumber)+"]")]):e._e()]):r("el-tag",{staticClass:"pointer",attrs:{size:"mini",type:"info"}},[e._v(e._s(t.row.flags))])]}}])}),e._v(" "),r("el-table-column",{attrs:{prop:"inCluster",label:"In Cluster",align:"center",sortable:""},scopedSlots:e._u([{key:"default",fn:function(e){return[e.row.inCluster?r("i",{staticClass:"el-icon-success status-icon normal-status"}):r("i",{staticClass:"el-icon-error status-icon normal-bad"})]}}])}),e._v(" "),r("el-table-column",{attrs:{prop:"runStatus",label:"Run Status",align:"center",sortable:""},scopedSlots:e._u([{key:"default",fn:function(e){return[e.row.runStatus?r("i",{staticClass:"el-icon-success status-icon normal-status"}):r("i",{staticClass:"el-icon-error status-icon normal-bad"})]}}])}),e._v(" "),r("el-table-column",{attrs:{prop:"host",label:"Host",sortable:""}}),e._v(" "),r("el-table-column",{attrs:{prop:"port",label:"Port",sortable:""}}),e._v(" "),"cluster"==e.cluster.redisMode?r("el-table-column",{attrs:{prop:"slotRange",label:"Slot Range",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n            "+e._s(t.row.slotRange)+"\n            "),null!=t.row.slotRange?r("el-tag",{attrs:{size:"mini"}},[e._v(e._s(t.row.slotNumber))]):e._e()]}}],null,!1,865138624)}):e._e()],1)],1)]),e._v(" "),e.replicateOfVisible?r("el-dialog",{attrs:{title:"Master Node List",visible:e.replicateOfVisible,"close-on-click-modal":!1,width:"80%"},on:{"update:visible":function(t){e.replicateOfVisible=t}}},[r("el-table",{attrs:{data:e.redisNodeList.filter(function(e){return e.inCluster}),stripe:"",size:"medium","default-sort":{prop:"slotRange",order:"ascending"}}},[r("el-table-column",{attrs:{label:"Link State",sortable:"",width:"150px"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n          "+e._s(t.row.slot)+"\n          "),"connected"==t.row.linkState?r("el-tag",{attrs:{size:"mini",type:"success"}},[e._v(e._s(t.row.linkState))]):r("el-tag",{staticClass:"pointer",attrs:{size:"small",type:"warning"}},[e._v(e._s(t.row.linkState))])]}}],null,!1,1084991063)}),e._v(" "),r("el-table-column",{attrs:{label:"Flags",width:"90px"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-tag",{attrs:{size:"mini"}},[e._v(e._s(t.row.flags))])]}}],null,!1,221223753)}),e._v(" "),r("el-table-column",{attrs:{label:"Replica",width:"80px"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-tag",{attrs:{size:"mini"}},[e._v(e._s(t.row.replicaNumber))])]}}],null,!1,1276046101)}),e._v(" "),r("el-table-column",{attrs:{label:"In Cluster",align:"center",sortable:""},scopedSlots:e._u([{key:"default",fn:function(e){return[e.row.inCluster?r("i",{staticClass:"el-icon-success status-icon normal-status"}):r("i",{staticClass:"el-icon-error status-icon normal-bad"})]}}],null,!1,1353933945)}),e._v(" "),r("el-table-column",{attrs:{label:"Run Status",align:"center",sortable:""},scopedSlots:e._u([{key:"default",fn:function(e){return[e.row.runStatus?r("i",{staticClass:"el-icon-success status-icon normal-status"}):r("i",{staticClass:"el-icon-error status-icon normal-bad"})]}}],null,!1,2493321961)}),e._v(" "),r("el-table-column",{attrs:{prop:"host",label:"Host",sortable:""}}),e._v(" "),r("el-table-column",{attrs:{prop:"port",label:"Port",sortable:""}}),e._v(" "),r("el-table-column",{attrs:{prop:"slotRange",label:"Slot Range",sortable:""}}),e._v(" "),r("el-table-column",{attrs:{prop:"time",label:"Time",sortable:""}}),e._v(" "),r("el-table-column",{attrs:{label:"Operation",width:"120px"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-button",{attrs:{size:"mini",type:"primary",disabled:(e.operationNode.nodeId==t.row.nodeId||e.operationNode.masterId==t.row.nodeId)&&e.operationNode.inCluster},on:{click:function(r){return e.replicateOf(t.row.nodeId)}}},[e._v("Replicate Of")])]}}],null,!1,2727245630)})],1)],1):e._e(),e._v(" "),e.failOverVisible?r("el-dialog",{attrs:{title:"Fail Over",visible:e.failOverVisible,width:"30%"},on:{"update:visible":function(t){e.failOverVisible=t}}},[r("span",[e._v(e._s(e.operationNode.host)+":"+e._s(e.operationNode.port)+" will become the master")]),e._v(" "),r("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{size:"small"},on:{click:function(t){e.failOverVisible=!1}}},[e._v("Cancel")]),e._v(" "),r("el-button",{attrs:{size:"small",type:"warning"},on:{click:function(t){return e.failOver()}}},[e._v("Fail Over")])],1)]):e._e(),e._v(" "),e.importNodeVisible?r("el-dialog",{attrs:{title:"Import New Node",visible:e.importNodeVisible,"close-on-click-modal":!1,width:"30%"},on:{"update:visible":function(t){e.importNodeVisible=t}}},[r("el-form",{ref:"newRedisNode",attrs:{model:e.newRedisNode,size:"small"}},[r("el-form-item",{attrs:{label:"Redis Node",prop:"address",rules:e.rules.redisNode}},[r("el-input",{model:{value:e.newRedisNode.address,callback:function(t){e.$set(e.newRedisNode,"address",t)},expression:"newRedisNode.address"}})],1)],1),e._v(" "),r("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{size:"small"},on:{click:function(t){e.importNodeVisible=!1}}},[e._v("Cancel")]),e._v(" "),r("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.importNode("newRedisNode")}}},[e._v("Confirm")])],1)],1):e._e(),e._v(" "),r("el-dialog",{attrs:{title:"Edit Config",visible:e.editConfigVisible,"close-on-click-modal":!1,width:"30%"},on:{"update:visible":function(t){e.editConfigVisible=t}}},[r("el-form",{ref:"redisConfig",attrs:{model:e.redisConfig,size:"small","label-position":"top"}},[r("el-form-item",{attrs:{label:"Config Key",prop:"configKey",rules:e.rules.configKey}},[r("el-select",{attrs:{filterable:"","allow-create":"","default-first-option":"",placeholder:"Please select config key"},on:{change:function(t){return e.getConfigCurrentValue(e.redisConfig)}},model:{value:e.redisConfig.configKey,callback:function(t){e.$set(e.redisConfig,"configKey",t)},expression:"redisConfig.configKey"}},e._l(e.configKeyList,function(e){return r("el-option",{key:e,attrs:{label:e,value:e}})}),1)],1),e._v(" "),r("el-form-item",{attrs:{label:"Config Value",prop:"configValue"}},[r("el-input",{model:{value:e.redisConfig.configValue,callback:function(t){e.$set(e.redisConfig,"configValue",t)},expression:"redisConfig.configValue"}})],1),e._v(" "),e._l(e.nodeConfigList,function(t){return r("p",{key:t.redisNode},[r("span",{staticStyle:{color:"#606266"}},[e._v(e._s(t.redisNode))]),e._v(" "),r("span",[r("b",[e._v(e._s(t.configValue))])])])})],2),e._v(" "),r("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{size:"small"},on:{click:function(t){e.editConfigVisible=!1}}},[e._v("Cancel")]),e._v(" "),r("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.editConfig("redisConfig")}}},[e._v("Confirm")])],1)],1),e._v(" "),e.forgetVisible?r("el-dialog",{attrs:{title:"Forget Node",visible:e.forgetVisible,width:"30%"},on:{"update:visible":function(t){e.forgetVisible=t}}},[r("span",[e._v(e._s(e.operationNode.host)+":"+e._s(e.operationNode.port)+" will be forget")]),e._v(" "),r("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{size:"small"},on:{click:function(t){e.forgetVisible=!1}}},[e._v("Cancel")]),e._v(" "),r("el-button",{attrs:{size:"small",type:"warning"},on:{click:function(t){return e.forget()}}},[e._v("Forget")])],1)]):e._e(),e._v(" "),e.moveSlotVisible?r("el-dialog",{attrs:{title:"Move Slot",visible:e.moveSlotVisible,"close-on-click-modal":!1,width:"30%"},on:{"update:visible":function(t){e.moveSlotVisible=t}}},[r("el-form",{ref:"slotRange",attrs:{model:e.slotRange,size:"small"}},[r("el-form-item",{attrs:{prop:"startSlot",label:"Start Slot",rules:e.rules.startSlot}},[r("el-input",{model:{value:e.slotRange.startSlot,callback:function(t){e.$set(e.slotRange,"startSlot",e._n(t))},expression:"slotRange.startSlot"}})],1),e._v(" "),r("el-form-item",{attrs:{prop:"endSlot",label:"End Slot",rules:e.rules.endSlot}},[r("el-input",{model:{value:e.slotRange.endSlot,callback:function(t){e.$set(e.slotRange,"endSlot",e._n(t))},expression:"slotRange.endSlot"}})],1)],1),e._v(" "),r("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{size:"small"},on:{click:function(t){e.moveSlotVisible=!1}}},[e._v("Cancel")]),e._v(" "),r("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.moveSlot("slotRange")}}},[e._v("Confirm")])],1)],1):e._e(),e._v(" "),r("el-dialog",{attrs:{title:"Start Node",visible:e.startNodeVisible,width:"30%","close-on-click-modal":!1},on:{"update:visible":function(t){e.startNodeVisible=t}}},[r("span",[e._v(e._s(e.operationNode.host)+":"+e._s(e.operationNode.port)+" will be start")]),e._v(" "),r("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{size:"small"},on:{click:function(t){e.startNodeVisible=!1}}},[e._v("Cancel")]),e._v(" "),r("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.startNode()}}},[e._v("Start")])],1)]),e._v(" "),r("el-dialog",{attrs:{title:"Stop Node",visible:e.stopNodeVisible,width:"30%","close-on-click-modal":!1},on:{"update:visible":function(t){e.stopNodeVisible=t}}},[r("span",[e._v(e._s(e.operationNode.host)+":"+e._s(e.operationNode.port)+" will be stop")]),e._v(" "),r("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{size:"small"},on:{click:function(t){e.stopNodeVisible=!1}}},[e._v("Cancel")]),e._v(" "),r("el-button",{attrs:{size:"small",type:"danger"},on:{click:function(t){return e.stopNode()}}},[e._v("Stop")])],1)]),e._v(" "),r("el-dialog",{attrs:{title:"Restart Node",visible:e.restartNodeVisible,width:"30%","close-on-click-modal":!1},on:{"update:visible":function(t){e.restartNodeVisible=t}}},[r("span",[e._v(e._s(e.operationNode.host)+":"+e._s(e.operationNode.port)+" will be restart")]),e._v(" "),r("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{size:"small"},on:{click:function(t){e.restartNodeVisible=!1}}},[e._v("Cancel")]),e._v(" "),r("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.restartNode()}}},[e._v("Restart")])],1)]),e._v(" "),r("el-dialog",{attrs:{title:"Delete Node",visible:e.deleteNodeVisible,width:"30%","close-on-click-modal":!1},on:{"update:visible":function(t){e.deleteNodeVisible=t}}},[r("span",[e._v(e._s(e.operationNode.host)+":"+e._s(e.operationNode.port)+" will be delete")]),e._v(" "),r("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{size:"small"},on:{click:function(t){e.deleteNodeVisible=!1}}},[e._v("Cancel")]),e._v(" "),r("el-button",{attrs:{size:"small",type:"danger"},on:{click:function(t){return e.deleteNode()}}},[e._v("Delete")])],1)]),e._v(" "),r("el-dialog",{attrs:{title:"Init Slot",visible:e.initSlotsVisible,width:"30%","close-on-click-modal":!1},on:{"update:visible":function(t){e.initSlotsVisible=t}}},[r("p",[e._v("\n      Cluster Slots All:\n      "),r("b",[e._v("16384")])]),e._v(" "),r("p",[e._v("\n      Cluster Slots Assigned:\n      "),r("b",[e._v(e._s(e.cluster.clusterSlotsAssigned))])]),e._v(" "),r("p",[e._v("\n      Cluster Slots Ok:\n      "),r("b",[e._v(e._s(e.cluster.clusterSlotsOk))])]),e._v(" "),r("p",[e._v("\n      Cluster Slots Pfail:\n      "),r("b",[e._v(e._s(e.cluster.clusterSlotsPfail))])]),e._v(" "),r("p",[e._v("\n      Cluster Slots Fail:\n      "),r("b",[e._v(e._s(e.cluster.clusterSlotsFail))])]),e._v(" "),r("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.initSlots()}}},[e._v("Init")])],1)]),e._v(" "),e.infoVisible?r("el-dialog",{attrs:{title:"Info - "+e.operationNode.host+":"+e.operationNode.port,visible:e.infoVisible,width:"50%","close-on-click-modal":!1,top:"5vh"},on:{"update:visible":function(t){e.infoVisible=t}}},[r("info",{attrs:{redisNode:e.operationNode}})],1):e._e(),e._v(" "),e.configVisible?r("el-dialog",{attrs:{title:"Config - "+e.operationNode.host+":"+e.operationNode.port,visible:e.configVisible,width:"50%","close-on-click-modal":!1,top:"5vh"},on:{"update:visible":function(t){e.configVisible=t}}},[r("config",{attrs:{redisNode:e.operationNode}})],1):e._e(),e._v(" "),e.sentinelMasterInfoVisible?r("el-dialog",{attrs:{title:"Sentinel Master Info",visible:e.sentinelMasterInfoVisible,"close-on-click-modal":!1,width:"40%"},on:{"update:visible":function(t){e.sentinelMasterInfoVisible=t}}},[r("sentinelMasterInfo",{attrs:{sentinelMaster:e.sentinelMaster}})],1):e._e(),e._v(" "),e.sentinelMasterSlavesVisible?r("el-dialog",{attrs:{title:"Sentinel Master Slaves",visible:e.sentinelMasterSlavesVisible,"close-on-click-modal":!1,width:"40%"},on:{"update:visible":function(t){e.sentinelMasterSlavesVisible=t}}},[r("sentinelMasterSlaves",{attrs:{sentinelMaster:e.sentinelMaster}})],1):e._e(),e._v(" "),e.sentinelMasterEditVisible?r("el-dialog",{attrs:{title:"Sentinel Master Edit",visible:e.sentinelMasterEditVisible,"close-on-click-modal":!1,width:"40%"},on:{"update:visible":function(t){e.sentinelMasterEditVisible=t}}},[r("div",[r("el-form",{ref:"sentinelMaster",attrs:{model:e.sentinelMaster,rules:e.rules,"label-width":"200px",size:"small"}},[r("el-form-item",{attrs:{label:"Master Name",prop:"name"}},[e.isUpdateSentinelMaster?r("el-tag",{attrs:{size:"small"}},[e._v(e._s(e.sentinelMaster.name))]):r("el-input",{attrs:{maxlength:"30","show-word-limit":""},model:{value:e.sentinelMaster.name,callback:function(t){e.$set(e.sentinelMaster,"name",t)},expression:"sentinelMaster.name"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"Redis Node",prop:"redisNode"}},[e.isUpdateSentinelMaster?r("el-tag",{attrs:{size:"small"}},[e._v(e._s(e.sentinelMaster.host)+":"+e._s(e.sentinelMaster.port))]):r("el-input",{model:{value:e.sentinelMaster.redisNode,callback:function(t){e.$set(e.sentinelMaster,"redisNode",t)},expression:"sentinelMaster.redisNode"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"Quorum",prop:"quorum"}},[r("el-input",{model:{value:e.sentinelMaster.quorum,callback:function(t){e.$set(e.sentinelMaster,"quorum",e._n(t))},expression:"sentinelMaster.quorum"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"Down After Milliseconds",prop:"downAfterMilliseconds"}},[r("el-input",{model:{value:e.sentinelMaster.downAfterMilliseconds,callback:function(t){e.$set(e.sentinelMaster,"downAfterMilliseconds",e._n(t))},expression:"sentinelMaster.downAfterMilliseconds"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"Parallel Syncs",prop:"parallelSyncs"}},[r("el-input",{model:{value:e.sentinelMaster.parallelSyncs,callback:function(t){e.$set(e.sentinelMaster,"parallelSyncs",e._n(t))},expression:"sentinelMaster.parallelSyncs"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"Failover Timeout",prop:"failoverTimeout"}},[r("el-input",{model:{value:e.sentinelMaster.failoverTimeout,callback:function(t){e.$set(e.sentinelMaster,"failoverTimeout",e._n(t))},expression:"sentinelMaster.failoverTimeout"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"Auth Pass",prop:"authPass"}},[r("el-input",{model:{value:e.sentinelMaster.authPass,callback:function(t){e.$set(e.sentinelMaster,"authPass",t)},expression:"sentinelMaster.authPass"}})],1)],1),e._v(" "),r("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e.isUpdateSentinelMaster?r("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.updateSentinelMaster("sentinelMaster")}}},[e._v("Update")]):r("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.monitorMaster("sentinelMaster")}}},[e._v("Confirm")])],1)],1)]):e._e(),e._v(" "),r("el-dialog",{attrs:{title:"Delete Sentinel Master",visible:e.deleteSentinelMasterVisible,width:"30%","close-on-click-modal":!1},on:{"update:visible":function(t){e.deleteSentinelMasterVisible=t}}},[r("span",[e._v(e._s(e.sentinelMaster.host)+":"+e._s(e.sentinelMaster.port)+" will be not monitored")]),e._v(" "),r("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{size:"small"},on:{click:function(t){e.deleteSentinelMasterVisible=!1}}},[e._v("Cancel")]),e._v(" "),r("el-button",{attrs:{size:"small",type:"danger"},on:{click:function(t){return e.deleteSentinelMaster()}}},[e._v("Delete")])],1)]),e._v(" "),r("el-dialog",{attrs:{title:"Failover Sentinel Master",visible:e.failoverSentinelMasterVisible,width:"30%","close-on-click-modal":!1},on:{"update:visible":function(t){e.failoverSentinelMasterVisible=t}}},[r("span",[e._v(e._s(e.sentinelMaster.host)+":"+e._s(e.sentinelMaster.port)+" will failover")]),e._v(" "),r("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{size:"small"},on:{click:function(t){e.failoverSentinelMasterVisible=!1}}},[e._v("Cancel")]),e._v(" "),r("el-button",{attrs:{size:"small",type:"danger"},on:{click:function(t){return e.failoverSentinelMaster()}}},[e._v("Failover")])],1)])],1)},staticRenderFns:[]},!1,function(e){r("yZWR")},"data-v-790ce778",null).exports,re=r("hRKE"),se=r.n(re),ie="/apis",ae={data:function(){var e=this,t=function(e,t,r){if(t<=0)return r(new Error("Number must be greater than 0"));r()};return{endPort:"",dockerImages:[],machineImages:[],humpbackImages:[],installationParam:{groupId:"",clusterName:"",redisPassword:"",redisMode:"cluster",image:"",create:!0,machineIdList:[],machineList:[{ip:""},{ip:""}],autoBuild:!0,autoInit:!1,sudo:!0,machineUserName:"",machinePassword:"",redisNodes:"127.0.0.1:8001 master\n127.0.0.1:8002",installationEnvironment:0},installationInfoVisible:!1,installationConsole:"Prepare to install redis...",rules:{clusterName:[{required:!0,validator:function(e,t,r){if(l(t)||l(t.trim()))return r(new Error("Please enter cluster name"));var s="/cluster/validateClusterName/"+t;he.get(s,null,function(e){var s=e.data;if(0!=s.code)return s.data,r(new Error(t+" has exist"));r()},function(e){return r(new Error("Network error, "+e))})},trigger:"blur"},{required:!0,validator:function(e,t,r){if(l(t)||l(t.trim()))return r(new Error("Please enter cluster name"));var s="/installation/validateClusterName/"+t;he.get(s,null,function(e){var s=e.data;if(0!=s.code)return s.data,r(new Error(t+" is being installed"));r()},function(e){return r(new Error("Network error, "+e))})},trigger:"blur"}],installationEnvironment:[{required:!0,message:"Please select installation environment",trigger:"change"}],image:[{required:!0,message:"Please select image",trigger:"change"}],machines:[{required:!0,message:"Please select machines",trigger:"change"}],startPort:[{required:!0,message:"Please enter start port",trigger:"blur"},{required:!0,validator:function(e,t,r){if(!/^([0-9]|[1-9]\d|[1-9]\d{2}|[1-9]\d{3}|[1-5]\d{4}|6[0-4]\d{3}|65[0-4]\d{2}|655[0-2]\d|6553[0-5])$/.test(t))return r(new Error("Incorrect port format"));r()},trigger:"blur"}],masterNumber:[{required:!0,message:"Please eneter master number",trigger:"blur"},{type:"number",message:"Please enter integer",trigger:"blur"},{required:!0,validator:t,trigger:"blur"},{required:!0,validator:function(t,r,s){if("standalone"==e.installationParam.redisMode&&r>1)return s(new Error("Standalone mode only need 1 master"));s()},trigger:"blur"}],replicaNumber:[{required:!0,message:"Please eneter replica number",trigger:"blur"},{type:"number",message:"Please enter integer",trigger:"blur"},{required:!0,validator:t,trigger:"blur"}],machineUserName:[{required:!0,message:"Please enter machine user name",trigger:"blur"}],machinePassword:[{required:!0,message:"Please enter machine password",trigger:"blur"}],redisNodes:[{required:!0,message:"Please enter redis topology",trigger:"blur"},{required:!0,validator:function(t,r,s){var i=r.trim();if(l(i))return s(new Error("Please enter topology"));var a=e.installationParam.machineUserName,n=e.installationParam.machinePassword;if(l(a)||l(n))return s(new Error("Please enter machine user name and password first"));for(var o=i.split(/[(\r\n)\r\n]+/),u=o.length,c=[],m=[],p=function(){var t=o[f].split(/\s+/),r=t.length;if(0==f){if(2!=r)return{v:s(new Error("Line "+(f+1)+": wrong format"))};if("master"!=t[1])return{v:s(new Error("Line "+(f+1)+": node not master"))}}if(0!=f&&"standalone"==e.installationParam.redisMode&&"master"==t[1])return{v:s(new Error("Line "+(f+1)+": standalone mode only need one master"))};var i=t[1];l(i)&&(i="slave");var u=t[0].split(":");if(d(u))return{v:s(new Error("Line "+(f+1)+": wrong format"))};var p=u[0],v=u[1],g={userName:a,password:n,host:p},h=!1;c.forEach(function(e){e.host!=p||(h=!0)}),h||c.push(g);var b=!1;if(m.forEach(function(e){e.host==p&&e.port==v&&(b=!0)}),b)return{v:s(new Error("Line "+(f+1)+": redis node repeat"))};m.push({host:p,port:v,nodeRole:i.toLocaleUpperCase()})},f=0;f<u;f++){var v=p();if("object"===(void 0===v?"undefined":se()(v)))return v.v}e.installationParam.machineList=c,e.installationParam.redisNodeList=m,s()},trigger:"blur"}]},allMachineList:[],installationLoading:!1,humpbackEnabled:!1,logTimer:null,isInstallationStart:!1}},methods:{handleMachine:function(e){e.forEach(function(e){})},buildMachineIdList:function(){var e=this;this.installationParam.machineIdList=[],this.installationParam.machines.forEach(function(t){e.installationParam.machineIdList.push(t[1])})},buildParam:function(){var e=this.installationParam;e.autoBuild&&this.buildMachineIdList();var t={groupId:this.currentGroup.groupId,userId:Le.getters.getUserId,clusterName:e.clusterName,redisPassword:e.redisPassword,redisMode:e.redisMode,installationEnvironment:e.installationEnvironment,image:e.image,clusterInfo:e.clusterInfo};this.installationParam.cluster=t},installationCheck:function(e){var t=this;this.$refs[e].validate(function(e){if(!e)return!1;t.buildParam(),t.isInstallationStart=!0,t.install()})},install:function(){var e=this;this.installationLoading=!0,he.post("/installation/installFlow",this.installationParam,function(t){var r=t.data;console.log(r),0==r.code?e.$router.push({name:"dashboard",params:{groupId:e.currentGroup.groupId}}):v.error("Install failed"),e.installationLoading=!1},function(t){e.installationLoading=!1,v.error(t)})},getDockerImageList:function(){var e=this;he.get("/installation/getDockerImages",null,function(t){var r=t.data;0==r.code?e.dockerImages=r.data:v.error(r.message)},function(e){v.error(e)})},getMachineImageList:function(){var e=this;he.get("/installation/getMachineImages",null,function(t){var r=t.data;0==r.code?e.machineImages=r.data:v.error(r.message)},function(e){v.error(e)})},getHumpbackImageList:function(){var e=this;he.get("/installation/getHumpbackImages",null,function(t){var r=t.data;0==r.code?e.humpbackImages=r.data:v.error(r.message)},function(e){v.error(e)})},getMachineList:function(e){var t=this;if(!l(e)){var r="/machine/getHierarchyMachineList/"+e;he.get(r,null,function(e){var r=e.data;if(0==r.code){var s=r.data;s.forEach(function(e){var r=e.machineGroupName;e.label=r,e.value=r,e.children.forEach(function(e){e.label=e.host,e.value=e.machineId}),t.allMachineList=s})}else v.error(r.message)},function(e){v.error(e)})}},validateMachine:function(e,t){},getHumpbackEnabled:function(){var e=this;he.get("/system/humpbackEnabled",null,function(t){var r=t.data.data;r&&(e.humpbackEnabled=r,e.getHumpbackImageList())},function(e){v.error(e)})},getLogs:function(){var e=this;if(this.isInstallationStart){var t="/installation/getInstallationLogs/"+this.installationParam.cluster.clusterName;he.get(t,null,function(t){var r=t.data.data;0!=r.length&&r.forEach(function(t){console.log(t),l(t)||t.indexOf("Start saving to database")>-1&&(e.step=6,console.log(6),e.installationLoading=!1,v.success("Install Successfully"))})},function(e){v.error(e)})}}},computed:{currentGroup:function(){return Le.getters.getCurrentGroup},installationEnvironmentList:function(){return Le.getters.getInstallationEnvironmentList}},watch:{"installationParam.autoBuild":function(e,t){this.$refs.installationParam.fields.map(function(e){if("startPort"===e.prop||"masterNumber"===e.prop||"replicaNumber"===e.prop||"machineUserName"===e.prop||"machinePassword"===e.prop||"topology"===e.prop||"machines"===e.prop)return e.resetField(),!1})},"installationParam.installationEnvironment":function(e,t){this.$refs.installationParam.fields.map(function(e){if("image"===e.prop)return e.resetField(),!1})},currentGroup:function(e){var t=e.groupId;this.$router.push({name:"installation",params:{groupId:t}}),this.getMachineList(t)}},mounted:function(){var e=this;this.getDockerImageList(),this.getMachineImageList();var t=this.currentGroup.groupId;this.getMachineList(t),this.getHumpbackEnabled(),null==this.logTimer&&(this.logTimer=setInterval(function(){e.getLogs()},1e3))},created:function(){clearInterval(this.logTimer),this.logTimer=null},beforeDestroy:function(){clearInterval(this.logTimer),this.logTimer=null}},ne=r("C7Lr")(ae,{render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"body-wrapper",attrs:{id:"installation"}},[r("el-row",{staticClass:"row-bg",attrs:{type:"flex",justify:"center"}},[r("el-col",{directives:[{name:"loading",rawName:"v-loading",value:e.installationLoading,expression:"installationLoading"}],attrs:{xl:12,lg:12,md:24,sm:24}},[r("div",{staticClass:"form-wrapper"},[r("div",{staticClass:"form"},[r("el-form",{ref:"installationParam",staticClass:"demo-ruleForm",attrs:{model:e.installationParam,rules:e.rules,"label-width":"150px",size:"small"}},[r("el-form-item",{attrs:{label:"Group Name",prop:"groupName"}},[r("el-tag",{attrs:{size:"small"}},[e._v(e._s(e.currentGroup.groupName))])],1),e._v(" "),r("el-form-item",{attrs:{label:"Cluster Name",prop:"clusterName"}},[r("el-input",{attrs:{maxlength:"50","show-word-limit":""},model:{value:e.installationParam.clusterName,callback:function(t){e.$set(e.installationParam,"clusterName",t)},expression:"installationParam.clusterName"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"Redis Password",prop:"redisPassword"}},[r("el-input",{attrs:{maxlength:"50","show-word-limit":""},model:{value:e.installationParam.redisPassword,callback:function(t){e.$set(e.installationParam,"redisPassword","string"==typeof t?t.trim():t)},expression:"installationParam.redisPassword"}})],1),e._v(" "),0==e.installationParam.installationEnvironment?r("el-form-item",{attrs:{label:"Image",prop:"image"}},[r("el-select",{attrs:{"allow-create":"",filterable:"",placeholder:"Please choose image"},model:{value:e.installationParam.image,callback:function(t){e.$set(e.installationParam,"image","string"==typeof t?t.trim():t)},expression:"installationParam.image"}},e._l(e.dockerImages,function(e){return r("el-option",{key:e,attrs:{label:e,value:e}})}),1)],1):1==e.installationParam.installationEnvironment?r("el-form-item",{attrs:{label:"Image",prop:"image"}},[r("el-select",{attrs:{placeholder:"Please choose image"},model:{value:e.installationParam.image,callback:function(t){e.$set(e.installationParam,"image","string"==typeof t?t.trim():t)},expression:"installationParam.image"}},e._l(e.machineImages,function(e){return r("el-option",{key:e,attrs:{label:e,value:e}})}),1)],1):e._e(),e._v(" "),3==e.installationParam.installationEnvironment?r("el-form-item",{attrs:{label:"Image",prop:"image"}},[r("el-select",{attrs:{"allow-create":"",filterable:"",placeholder:"Please choose image"},model:{value:e.installationParam.image,callback:function(t){e.$set(e.installationParam,"image","string"==typeof t?t.trim():t)},expression:"installationParam.image"}},e._l(e.humpbackImages,function(e){return r("el-option",{key:e,attrs:{label:e,value:e}})}),1)],1):e._e(),e._v(" "),e.installationParam.autoBuild?r("el-form-item",{attrs:{label:"Machine List",prop:"machines"}},[r("div",{staticClass:"block"},[r("el-cascader",{attrs:{placeholder:"Search",options:e.allMachineList,props:{multiple:!0},filterable:"",leafOnly:!0},on:{change:e.handleMachine},model:{value:e.installationParam.machines,callback:function(t){e.$set(e.installationParam,"machines",t)},expression:"installationParam.machines"}})],1)]):e._e(),e._v(" "),e.installationParam.autoBuild?r("el-form-item",{attrs:{label:"Start Port",prop:"startPort"}},[r("el-input",{model:{value:e.installationParam.startPort,callback:function(t){e.$set(e.installationParam,"startPort",e._n(t))},expression:"installationParam.startPort"}})],1):e._e(),e._v(" "),r("el-form-item",{attrs:{label:"End Port"}},[r("el-input",{model:{value:e.endPort,callback:function(t){e.endPort=t},expression:"endPort"}})],1),e._v(" "),e.installationParam.autoBuild?r("el-form-item",{attrs:{label:"Master Number",prop:"masterNumber"}},[r("el-input",{model:{value:e.installationParam.masterNumber,callback:function(t){e.$set(e.installationParam,"masterNumber",e._n(t))},expression:"installationParam.masterNumber"}})],1):e._e(),e._v(" "),e.installationParam.autoBuild?r("el-form-item",{attrs:{label:"Replica Number",prop:"replicaNumber"}},[r("el-input",{model:{value:e.installationParam.replicaNumber,callback:function(t){e.$set(e.installationParam,"replicaNumber",e._n(t))},expression:"installationParam.replicaNumber"}})],1):e._e(),e._v(" "),e.installationParam.autoBuild?e._e():r("el-form-item",{attrs:{label:"Machine User",prop:"machineUserName"}},[r("el-input",{attrs:{placeholder:"Machine user name"},model:{value:e.installationParam.machineUserName,callback:function(t){e.$set(e.installationParam,"machineUserName","string"==typeof t?t.trim():t)},expression:"installationParam.machineUserName"}})],1),e._v(" "),e.installationParam.autoBuild?e._e():r("el-form-item",{attrs:{label:"Machine Password",prop:"machinePassword"}},[r("el-input",{attrs:{placeholder:"Machine password"},model:{value:e.installationParam.machinePassword,callback:function(t){e.$set(e.installationParam,"machinePassword","string"==typeof t?t.trim():t)},expression:"installationParam.machinePassword"}})],1),e._v(" "),e.installationParam.autoBuild?e._e():r("el-form-item",{attrs:{label:"Topology",prop:"redisNodes"}},[r("el-input",{staticClass:"textarea",attrs:{type:"textarea",autosize:{minRows:2,maxRows:500},placeholder:"Please enter redis node list"},model:{value:e.installationParam.redisNodes,callback:function(t){e.$set(e.installationParam,"redisNodes",t)},expression:"installationParam.redisNodes"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"Cluster Info",prop:"clusterInfo"}},[r("el-input",{attrs:{type:"input"},model:{value:e.installationParam.clusterInfo,callback:function(t){e.$set(e.installationParam,"clusterInfo",t)},expression:"installationParam.clusterInfo"}})],1),e._v(" "),r("el-form-item",[r("el-button",{attrs:{type:"success"},on:{click:function(t){return e.installationCheck("installationParam")}}},[e._v("Install")])],1)],1)],1)])])],1)],1)},staticRenderFns:[]},!1,function(e){r("scWc")},"data-v-2e13e6ed",null).exports,oe={data:function(){var e=this;return{machineList:[],machineGroupNameList:[],editMachineVisible:!1,isUpdate:!1,deleteVisible:!1,deleteBatchVisible:!1,batchDelete:!1,machines:{hostList:[{value:""}],sshPort:22},rules:{machineGroupName:[{required:!0,validator:function(e,t,r){if(l(t)||l(t.trim()))return r(new Error("Please select or enter machine group name"));r()},trigger:"blur"}],userName:[{required:!0,validator:function(e,t,r){if(l(t)||l(t.trim()))return r(new Error("Please enter machine user name"));r()},trigger:"blur"}],password:[{required:!0,validator:function(e,t,r){if(l(t)||l(t.trim()))return r(new Error("Please enter machine password"));r()},trigger:"blur"}],host:[{required:!0,validator:function(e,t,r){return l(t)||l(t.trim())?r(new Error("Please enter machine ip")):/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/.test(t)?void r():r(new Error("Incorrect ip format"))},trigger:"blur"},{required:!0,validator:function(t,r,s){var i=e.machines.userName,a=e.machines.password,n=e.machines.sshPort;if(l(i)||l(i.trim())||l(a)||l(a.trim()))return s(new Error("Please enter user name and passwor first"));var o={userName:i,password:a,host:r,sshPort:n};he.post("/machine/validateConnection",o,function(e){var t=e.data;if(0!=t.code)return s(new Error(t.message));s()},function(e){return s(new Error("Network error"))})},trigger:"blur"}]},search:"",selectedMachineList:[],saveMachineLoading:!1}},methods:{getMachineList:function(e){var t=this;if(!l(e)){var r="/machine/getMachineList/"+e;he.get(r,null,function(e){var r=e.data;if(0==r.code){var s=r.data;s.forEach(function(e){e.time=L(e.updateTime)}),t.machineList=s}else v.error("Get machine list failed")},function(e){v.error(e)})}},getMachineGroupNameList:function(e){var t=this,r="/machine/getMachineGroupNameList/"+e;he.get(r,null,function(e){var r=e.data;0==r.code?t.machineGroupNameList=r.data:v.error("Get machine group name list failed")},function(e){v.error(e)})},buildMachineList:function(e){var t=this,r=[];if(this.isUpdate)return r.push(e),r;var s=this.machines.machineGroupName,i=this.machines.userName,a=this.machines.password,n=this.machines.token,o=this.machines.hostList,u=this.machines.machineInfo,c=this.machines.sshPort;return c=l(c)?22:c,o.forEach(function(e){r.push({groupId:t.currentGroupId,machineGroupName:s,userName:i,password:a,token:n,host:e.value,sshPort:c,machineInfo:u})}),r},saveMachines:function(e){var t=this;this.$refs[e].validate(function(r){if(r){var s,i=t.buildMachineList(t.machines);s=t.isUpdate?"/machine/updateMachine":"/machine/addMachineList",t.saveMachineLoading=!0,he.post(s,i,function(r){0==r.data.code?(t.editMachineVisible=!1,t.getMachineGroupNameList(t.currentGroupId),t.getMachineList(t.currentGroupId)):v.error("Save machines failed"),t.$refs[e].resetFields(),t.saveMachineLoading=!1},function(e){t.saveMachineLoading=!0,v.error(e)})}})},editMachine:function(e,t){this.machines=t,this.editMachineVisible=!0,this.isUpdate=!0},handleDelete:function(e,t){this.machines=t,this.deleteVisible=!0,this.batchDelete=!1},handleDeleteBatch:function(){this.batchDelete=!0,0==this.selectedMachineList.length?v.warning("Please select machine"):this.deleteBatchVisible=!0},deleteMachine:function(){var e=this,t="",r=void 0;this.batchDelete?(t="/machine/deleteMachineBatch",(r=this.selectedMachineList).forEach(function(e){e.updateTime=new Date})):(t="/machine/deleteMachine",(r=this.machines).updateTime=new Date),he.post(t,r,function(t){0==t.data.code?(e.deleteVisible=!1,e.deleteBatchVisible=!1,e.getMachineGroupNameList(e.currentGroupId),e.getMachineList(e.currentGroupId),e.machines={hostList:[{value:""}]},e.selectedMachineList=[]):v.error("Delete machine failed")},function(e){v.error(e)})},removeHost:function(e){if(1!=this.machines.hostList.length){var t=this.machines.hostList.indexOf(e);-1!==t&&this.machines.hostList.splice(t,1)}},addHost:function(){this.machines.hostList.length>=20||this.machines.hostList.push({value:"",key:Date.now()})},handleSelectionChange:function(e){this.selectedMachineList=e}},computed:{currentGroupId:function(){return Le.getters.getCurrentGroup.groupId}},watch:{currentGroupId:function(e){this.getMachineList(e),this.$router.push({name:"machine-manage",params:{groupId:e}})}},mounted:function(){var e=this.currentGroupId;this.getMachineList(e),this.getMachineGroupNameList(e)}},le=r("C7Lr")(oe,{render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"body-wrapper"},[r("div",{staticClass:"batch-operation-wrapper"},[r("div",{staticClass:"batch-title"},[e._v("Batch Operation")]),e._v(" "),r("el-row",[r("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(t){return e.handleDeleteBatch()}}},[e._v("Delete")]),e._v(" "),r("el-button",{attrs:{size:"mini",type:"success"},on:{click:function(t){e.editMachineVisible=!0,e.isUpdate=!1,e.machines={hostList:[{value:""}]}}}},[e._v("Import Machine")])],1)],1),e._v(" "),r("div",[r("el-table",{staticStyle:{width:"100%"},attrs:{data:e.machineList,center:"","default-sort":{prop:"machineGroupName",order:"ascending"}},on:{"selection-change":e.handleSelectionChange}},[r("el-table-column",{attrs:{type:"selection",width:"55"}}),e._v(" "),r("el-table-column",{attrs:{property:"machineGroupName",label:"Machine Group Name",width:"200",sortable:""}}),e._v(" "),r("el-table-column",{attrs:{property:"host",label:"Host",sortable:""}}),e._v(" "),r("el-table-column",{attrs:{property:"userName",label:"User Name"}}),e._v(" "),r("el-table-column",{attrs:{label:"Password",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-popover",{attrs:{trigger:"hover",placement:"top"}},[r("p",[e._v(e._s(t.row.password))]),e._v(" "),r("div",{staticClass:"name-wrapper",attrs:{slot:"reference"},slot:"reference"},[r("el-tag",{attrs:{size:"small",type:"info"}},[e._v("******")])],1)])]}}])}),e._v(" "),r("el-table-column",{attrs:{property:"machineInfo",label:"Info"}}),e._v(" "),r("el-table-column",{attrs:{property:"time",label:"Time",sortable:""}}),e._v(" "),r("el-table-column",{attrs:{label:"Operation",width:"200px;"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(r){return e.editMachine(t.$index,t.row)}}},[e._v("Edit")]),e._v(" "),r("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(r){return e.handleDelete(t.$index,t.row)}}},[e._v("Delete")])]}}])})],1)],1),e._v(" "),r("el-dialog",{directives:[{name:"loading",rawName:"v-loading",value:e.saveMachineLoading,expression:"saveMachineLoading"}],attrs:{title:"Edit machines",visible:e.editMachineVisible,width:"50%","close-on-click-modal":!1},on:{"update:visible":function(t){e.editMachineVisible=t}}},[r("el-form",{ref:"machines",attrs:{model:e.machines,rules:e.rules,size:"small","label-width":"135px"}},[r("el-form-item",{attrs:{label:"Machine Group",prop:"machineGroupName"}},[r("el-select",{attrs:{filterable:"","allow-create":"","default-first-option":"",placeholder:"Select or enter group"},model:{value:e.machines.machineGroupName,callback:function(t){e.$set(e.machines,"machineGroupName",t)},expression:"machines.machineGroupName"}},e._l(e.machineGroupNameList,function(e,t){return r("el-option",{key:t,attrs:{label:e,value:e}})}),1)],1),e._v(" "),r("el-form-item",{attrs:{label:"User Name",prop:"userName"}},[r("el-input",{model:{value:e.machines.userName,callback:function(t){e.$set(e.machines,"userName",t)},expression:"machines.userName"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"Password",prop:"password"}},[r("el-input",{model:{value:e.machines.password,callback:function(t){e.$set(e.machines,"password",t)},expression:"machines.password"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"SSH Port",prop:"sshPort"}},[r("el-input",{model:{value:e.machines.sshPort,callback:function(t){e.$set(e.machines,"sshPort",e._n(t))},expression:"machines.sshPort"}})],1),e._v(" "),e.isUpdate?r("el-form-item",{attrs:{label:"Host",prop:"host",rules:e.rules.host}},[r("el-input",{model:{value:e.machines.host,callback:function(t){e.$set(e.machines,"host",t)},expression:"machines.host"}})],1):r("div",e._l(e.machines.hostList,function(t,s){return r("el-form-item",{key:t.key,attrs:{label:"Host "+(s+1),prop:"hostList."+s+".value",rules:e.rules.host}},[r("el-input",{model:{value:t.value,callback:function(r){e.$set(t,"value",r)},expression:"host.value"}},[r("el-button",{attrs:{slot:"append",icon:"el-icon-delete"},on:{click:function(r){return r.preventDefault(),e.removeHost(t)}},slot:"append"})],1)],1)}),1),e._v(" "),r("el-form-item",{attrs:{label:"Machine Info",prop:"machineInfo"}},[r("el-input",{attrs:{maxlength:"50","show-word-limit":""},model:{value:e.machines.machineInfo,callback:function(t){e.$set(e.machines,"machineInfo",t)},expression:"machines.machineInfo"}})],1)],1),e._v(" "),r("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e.isUpdate?e._e():r("el-button",{attrs:{size:"small"},on:{click:function(t){return e.addHost()}}},[e._v("New Host")]),e._v(" "),e.isUpdate?r("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.saveMachines("machines")}}},[e._v("Update")]):r("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.saveMachines("machines")}}},[e._v("Confirm")])],1)],1),e._v(" "),r("el-dialog",{attrs:{title:"Delete Machine",visible:e.deleteVisible,width:"30%"},on:{"update:visible":function(t){e.deleteVisible=t}}},[r("span",[e._v("\n      Are you sure to delete\n      "),r("b",[e._v(e._s(e.machines.machineGroupName)+" "+e._s(e.machines.host))]),e._v(" ?\n    ")]),e._v(" "),r("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{size:"small"},on:{click:function(t){e.deleteVisible=!1}}},[e._v("Cancel")]),e._v(" "),r("el-button",{attrs:{size:"small",type:"danger"},on:{click:function(t){return e.deleteMachine(e.machines)}}},[e._v("Delete")])],1)]),e._v(" "),r("el-dialog",{attrs:{title:"Delete Machine Batch",visible:e.deleteBatchVisible,width:"30%"},on:{"update:visible":function(t){e.deleteBatchVisible=t}}},[r("span",[e._v("\n      Are you sure to delete ?\n      "),r("br"),e._v(" "),e._l(e.selectedMachineList,function(t,s){return r("div",{key:s},[e._v(e._s(t.machineGroupName)+" "+e._s(t.host))])})],2),e._v(" "),r("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{size:"small"},on:{click:function(t){e.deleteBatchVisible=!1}}},[e._v("Cancel")]),e._v(" "),r("el-button",{attrs:{size:"small",type:"danger"},on:{click:function(t){return e.deleteMachine(e.selectedMachineList)}}},[e._v("Delete")])],1)])],1)},staticRenderFns:[]},!1,function(e){r("EgnH")},"data-v-6226bd00",null).exports,ue={data:function(){var e,t=this;return e={userList:[],grantedUserList:[],user:{},isUpdate:!1,editUserVisible:!1,editGrantUserVisible:!1,deleteUserVisible:!1,revokeUserVisible:!1},A()(e,"isUpdate",!1),A()(e,"rules",{userRole:[{required:!0,message:"Please select user role",trigger:"blur"}],userName:[{required:!0,message:"Please enter user name",trigger:"blur"},{required:!0,validator:function(e,r,s){var i="/user/validateUserName/"+r;he.get(i,null,function(e){var i=e.data;0==i.code?s():t.user.userId!==i.data.userId?s(new Error(r+" has been used")):s()},function(e){return s(new Error("Network error"))})},trigger:"blur"}],password:[{required:!0,message:"Please enter password",trigger:"blur"}],email:[{validator:function(e,t,r){if(!l(t)&&!u(t))return r(new Error("Incorrect format"));r()},trigger:"blur"}],mobile:[{validator:function(e,t,r){if(!l(t)&&!c(t))return r(new Error("Incorrect format"));r()},trigger:"blur"}]}),A()(e,"grantUserRules",{userRole:[{required:!0,message:"Please select user role",trigger:"blur"}],userName:[{required:!0,message:"Please enter user name",trigger:"blur"},{required:!0,validator:function(e,r,s){var i="/user/validateUserName/"+r;he.get(i,null,function(e){var i=e.data;if(0==i.code)s(new Error(r+" not exist"));else{var a=i.data;he.get("/user/isGranted/"+t.currentGroup.groupId+"/"+a.userId,null,function(e){if(0!=e.data.code)return s(new Error(r+" has been granted"));s()},function(e){return s(new Error("Network error"))})}},function(e){return s(new Error("Network error"))})},trigger:"blur"}]}),A()(e,"saveUserLoading",!1),A()(e,"grantUserLoading",!1),e},methods:{handleEdit:function(e){this.getUserById(e.userId),this.isUpdate=!0,this.editUserVisible=!0},handleDelete:function(e){this.user=e,this.deleteUserVisible=!0},handleRevoke:function(e){this.user=e,this.revokeUserVisible=!0},getUserList:function(e){var t=this,r="/user/getUserList/"+e;he.get(r,null,function(e){var r=e.data;if(0==r.code){var s=r.data;s.forEach(function(e){var t=e.avatar;l(t)||(e.avatar=ie+t),e.time=L(e.updateTime)}),t.userList=s}},function(e){v.error(e)})},getGrantedUserList:function(e){var t=this,r="/user/getGrantedUserList/"+e;he.get(r,null,function(e){var r=e.data;if(0==r.code){var s=r.data;s.forEach(function(e){var t=e.avatar;l(t)||(e.avatar=ie+t),e.time=L(e.updateTime)}),t.grantedUserList=s}},function(e){v.error(e)})},getUserById:function(e){var t=this,r="/user/getUser/"+e;he.get(r,null,function(e){var r=e.data;0==r.code?t.user=r.data:v.error("Get user failed")},function(e){v.error(e)})},saveUser:function(e){var t=this;console.log(this.user),this.$refs[e].validate(function(r){if(r){t.saveUserLoading=!0;var s=t.currentGroup.groupId;t.user.groupId=s;var i;i=t.isUpdate?"/user/updateUser":"/user/addUser",he.post(i,t.user,function(r){var i=r.data;t.getUserList(s),0==i.code?(t.editUserVisible=!1,t.$refs[e].resetFields()):v.error("save user failed"),t.saveUserLoading=!1},function(e){t.saveUserLoading=!1,v.error(e)})}})},saveGroupUser:function(e){var t=this;this.$refs[e].validate(function(r){if(r){t.grantUserLoading=!0;var s=t.currentGroup.groupId;t.user.groupId=s,he.post("/user/grantUser",t.user,function(r){var i=r.data;t.getGrantedUserList(s),0==i.code?(t.editGrantUserVisible=!1,t.$refs[e].resetFields()):v.error("Save user failed"),t.grantUserLoading=!1},function(e){t.grantUserLoading=!1,v.error(e)})}})},deleteUser:function(){var e=this;he.post("/user/deleteUser",this.user,function(t){e.getUserList(e.currentGroup.groupId),e.deleteUserVisible=!1,e.user={}},function(e){v.error(e)})},revokeUser:function(){var e=this;he.post("/user/revokeUser",this.user,function(t){e.getGrantedUserList(e.currentGroup.groupId),e.revokeUserVisible=!1,e.user={}},function(e){v.error(e)})}},computed:{currentGroup:function(){return Le.getters.getCurrentGroup},currentUser:function(){return Le.getters.getUser}},watch:{currentGroup:function(e){var t=e.groupId;this.getUserList(t),this.getGrantedUserList(t),this.$router.push({name:"user-manage",params:{groupId:t}})}},mounted:function(){var e=this.currentGroup.groupId;this.getUserList(e),this.getGrantedUserList(e)}};r("C7Lr")(ue,{render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"container-wrapper",attrs:{id:"user-manage"}},[r("div",[r("div",{staticClass:"operation-wrapper"},[r("div",[e._v("Current Group")]),e._v(" "),r("el-button",{attrs:{size:"mini",type:"success"},on:{click:function(t){e.user={},e.editUserVisible=!0,e.isUpdate=!1}}},[e._v("Create")])],1),e._v(" "),r("el-table",{attrs:{data:e.userList}},[r("el-table-column",{attrs:{type:"index",width:"50"}}),e._v(" "),r("el-table-column",{attrs:{prop:"userName",label:"User Name"}}),e._v(" "),r("el-table-column",{attrs:{label:"User Role"},scopedSlots:e._u([{key:"default",fn:function(t){return[0==t.row.userRole?r("el-tag",{attrs:{size:"small",type:"success"}},[e._v("Super Admin")]):1==t.row.userRole?r("el-tag",{attrs:{size:"small",type:"primary"}},[e._v("Admin")]):r("el-tag",{attrs:{size:"small",type:"info"}},[e._v("Member")])]}}])}),e._v(" "),r("el-table-column",{attrs:{label:"Avatar"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-image",{attrs:{src:t.row.avatar,fit:"cover"}},[r("div",{staticClass:"image-slot",attrs:{slot:"error"},slot:"error"},[e._v(e._s(t.row.userName))])])]}}])}),e._v(" "),r("el-table-column",{attrs:{prop:"email",label:"Email"}}),e._v(" "),r("el-table-column",{attrs:{prop:"mobile",label:"Mobile"}}),e._v(" "),r("el-table-column",{attrs:{prop:"time",label:"Time"}}),e._v(" "),r("el-table-column",{attrs:{label:"Operation",width:"200px;"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.currentUser.userRole<=t.row.userRole?r("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(r){return e.handleEdit(t.row)}}},[e._v("Edit")]):e._e(),e._v(" "),e.currentUser.userRole<=t.row.userRole&&e.currentUser.userId!=t.row.userId?r("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(r){return e.handleDelete(t.row)}}},[e._v("Delete")]):e._e()]}}])})],1)],1),e._v(" "),r("div",{staticClass:"grant-wrapper"},[r("div",{staticClass:"operation-wrapper"},[r("div",[e._v("Other Groups")]),e._v(" "),r("el-button",{attrs:{size:"mini",type:"success"},on:{click:function(t){e.user={},e.editGrantUserVisible=!0}}},[e._v("Grant")])],1),e._v(" "),r("el-table",{attrs:{data:e.grantedUserList}},[r("el-table-column",{attrs:{type:"index",width:"50"}}),e._v(" "),r("el-table-column",{attrs:{prop:"userName",label:"User Name"}}),e._v(" "),r("el-table-column",{attrs:{label:"User Role"},scopedSlots:e._u([{key:"default",fn:function(t){return[0==t.row.userRole?r("el-tag",{attrs:{size:"small",type:"success"}},[e._v("Super Admin")]):1==t.row.userRole?r("el-tag",{attrs:{size:"small",type:"primary"}},[e._v("Admin")]):r("el-tag",{attrs:{size:"small",type:"info"}},[e._v("Member")])]}}])}),e._v(" "),r("el-table-column",{attrs:{label:"Avatar"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-image",{attrs:{src:t.row.avatar,fit:"cover"}},[r("div",{staticClass:"image-slot",attrs:{slot:"error"},slot:"error"},[e._v(e._s(t.row.userName))])])]}}])}),e._v(" "),r("el-table-column",{attrs:{prop:"email",label:"Email"}}),e._v(" "),r("el-table-column",{attrs:{prop:"mobile",label:"Mobile"}}),e._v(" "),r("el-table-column",{attrs:{prop:"time",label:"Time"}}),e._v(" "),r("el-table-column",{attrs:{label:"Operation",width:"200px;"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-button",{attrs:{size:"mini",type:"warning"},on:{click:function(r){return e.handleRevoke(t.row)}}},[e._v("Revoke")])]}}])})],1)],1),e._v(" "),r("el-dialog",{directives:[{name:"loading",rawName:"v-loading",value:e.saveUserLoading,expression:"saveUserLoading"}],attrs:{title:"Create User",visible:e.editUserVisible},on:{"update:visible":function(t){e.editUserVisible=t}}},[r("el-form",{ref:"user",attrs:{model:e.user,rules:e.rules,"label-width":"100px",size:"small"}},[r("el-form-item",{attrs:{label:"Group Name"}},[r("el-tag",{attrs:{size:"small"}},[e._v(e._s(e.currentGroup.groupName))])],1),e._v(" "),r("el-form-item",{attrs:{prop:"userRole",label:"User Role"}},[r("el-select",{attrs:{placeholder:"Please select user role"},model:{value:e.user.userRole,callback:function(t){e.$set(e.user,"userRole",t)},expression:"user.userRole"}},[r("el-option",{attrs:{label:"Member",value:2}}),e._v(" "),e.currentUser.userRole<2?r("el-option",{attrs:{label:"Admin",value:1}}):e._e(),e._v(" "),e.currentUser.userRole<1?r("el-option",{attrs:{label:"Super Admin",value:0}}):e._e()],1)],1),e._v(" "),r("el-form-item",{attrs:{prop:"userName",label:"User Name"}},[r("el-input",{model:{value:e.user.userName,callback:function(t){e.$set(e.user,"userName","string"==typeof t?t.trim():t)},expression:"user.userName"}})],1),e._v(" "),r("el-form-item",{attrs:{prop:"password",label:"Password"}},[r("el-input",{model:{value:e.user.password,callback:function(t){e.$set(e.user,"password","string"==typeof t?t.trim():t)},expression:"user.password"}})],1),e._v(" "),r("el-form-item",{attrs:{prop:"email",label:"Email"}},[r("el-input",{model:{value:e.user.email,callback:function(t){e.$set(e.user,"email","string"==typeof t?t.trim():t)},expression:"user.email"}})],1),e._v(" "),r("el-form-item",{attrs:{prop:"mobile",label:"Mobile"}},[r("el-input",{model:{value:e.user.mobile,callback:function(t){e.$set(e.user,"mobile","string"==typeof t?t.trim():t)},expression:"user.mobile"}})],1)],1),e._v(" "),r("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.saveUser("user")}}},[e._v("Confirm")])],1)],1),e._v(" "),r("el-dialog",{directives:[{name:"loading",rawName:"v-loading",value:e.grantUserLoading,expression:"grantUserLoading"}],attrs:{title:"Grant User",visible:e.editGrantUserVisible},on:{"update:visible":function(t){e.editGrantUserVisible=t}}},[r("el-form",{ref:"user",attrs:{model:e.user,rules:e.grantUserRules,"label-width":"100px",size:"small"}},[r("el-form-item",{attrs:{label:"Group Name"}},[r("el-tag",{attrs:{size:"small"}},[e._v(e._s(e.currentGroup.groupName))])],1),e._v(" "),r("el-form-item",{attrs:{prop:"userRole",label:"User Role"}},[r("el-select",{attrs:{placeholder:"Please select user role"},model:{value:e.user.userRole,callback:function(t){e.$set(e.user,"userRole",t)},expression:"user.userRole"}},[r("el-option",{attrs:{label:"Member",value:2}}),e._v(" "),e.currentUser.userRole<2?r("el-option",{attrs:{label:"Admin",value:1}}):e._e(),e._v(" "),e.currentUser.userRole<1?r("el-option",{attrs:{label:"Super Admin",value:0}}):e._e()],1)],1),e._v(" "),r("el-form-item",{attrs:{prop:"userName",label:"User Name"}},[r("el-input",{model:{value:e.user.userName,callback:function(t){e.$set(e.user,"userName","string"==typeof t?t.trim():t)},expression:"user.userName"}})],1)],1),e._v(" "),r("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.saveGroupUser("user")}}},[e._v("Confirm")])],1)],1),e._v(" "),r("el-dialog",{attrs:{title:"Delete User",visible:e.deleteUserVisible,width:"30%"},on:{"update:visible":function(t){e.deleteUserVisible=t}}},[r("span",[e._v("\n      Are you sure to delete\n      "),r("b",[e._v(e._s(e.user.userName))]),e._v(" ?\n    ")]),e._v(" "),r("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{size:"small"},on:{click:function(t){e.deleteUserVisible=!1}}},[e._v("Cancel")]),e._v(" "),r("el-button",{attrs:{size:"small",type:"danger"},on:{click:function(t){return e.deleteUser()}}},[e._v("Delete")])],1)]),e._v(" "),r("el-dialog",{attrs:{title:"Revoke User",visible:e.revokeUserVisible,width:"30%"},on:{"update:visible":function(t){e.revokeUserVisible=t}}},[r("span",[e._v("\n      Are you sure to revoke\n      "),r("b",[e._v(e._s(e.user.userName))]),e._v(" ?\n    ")]),e._v(" "),r("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{size:"small"},on:{click:function(t){e.revokeUserVisible=!1}}},[e._v("Cancel")]),e._v(" "),r("el-button",{attrs:{size:"small",type:"danger"},on:{click:function(t){return e.revokeUser()}}},[e._v("Revoke")])],1)])],1)},staticRenderFns:[]},!1,function(e){r("eFDd")},"data-v-13bdb593",null).exports;var ce={data:function(){return{user:{},avatarUrl:ie+"/user/saveAvatar",rules:{password:[{required:!0,message:"Please enter password",trigger:"blur"}],email:[{validator:function(e,t,r){if(!l(t)&&!u(t))return r(new Error("Incorrect format"));r()},trigger:"blur"}],mobile:[{validator:function(e,t,r){if(!l(t)&&!c(t))return r(new Error("Incorrect format"));r()},trigger:"blur"}]},updateUserLoading:!1}},methods:{getUser:function(e){var t=this,r="/user/getUser/"+e;he.get(r,null,function(e){var r=e.data;if(0==r.code){var s=r.data,i=s.avatar;l(i)||(s.avatar=ie+i),t.user=s}else v.error("Get user failed"),t.user=t.currentUser},function(e){v.error(e)})},updateUser:function(e){var t=this;this.$refs[e].validate(function(e){e&&(t.updateUserLoading=!0,he.post("/user/updateUser",t.user,function(e){0==e.data.code?v.success("update user successfully"):v.error("update user failed"),t.updateUserLoading=!1},function(e){t.updateUserLoading=!1,v.error(e)}))})},resetUser:function(e){this.getUser(this.currentUser.userId)},handleAvatarSuccess:function(e,t){var r=URL.createObjectURL(t.raw);this.user.avatar=r;var s=Le.getters.getUser;s.avatar=r,Le.dispatch("setUser",s)},beforeAvatarUpload:function(e){var t="image/jpeg"===e.type||"image/jpg",r=e.size/1024/1024<5;return t||v.error("Uploading images can only be in JPG or PNG format!"),r||v.error("Upload image size can't exceed 5MB!"),t&&r}},computed:{currentUser:function(){return Le.getters.getUser}},mounted:function(){var e=this.currentUser.userId;e!=this.$route.params.userId&&this.$$router.push({name:"profile",params:{userId:e}}),this.getUser(e)}},de=r("C7Lr")(ce,{render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{directives:[{name:"loading",rawName:"v-loading",value:e.updateUserLoading,expression:"updateUserLoading"}],staticClass:"body-wrapper",attrs:{id:"profile"}},[r("div",{staticClass:"profile-wrapper"},[r("el-form",{ref:"user",attrs:{model:e.user,"status-icon":"","label-width":"100px",rules:e.rules}},[r("el-form-item",{attrs:{label:"User Role",prop:"userRole"}},[0==e.user.userRole?r("el-tag",{attrs:{size:"small"}},[e._v("Super Admin")]):e._e(),e._v(" "),1==e.user.userRole?r("el-tag",{attrs:{size:"small"}},[e._v("Admin")]):e._e(),e._v(" "),2==e.user.userRole?r("el-tag",{attrs:{size:"small"}},[e._v("Member")]):e._e()],1),e._v(" "),r("el-form-item",{attrs:{label:"User Name",prop:"userName"}},[r("el-tag",{attrs:{size:"small"}},[e._v(e._s(e.user.userName))])],1),e._v(" "),r("el-form-item",{attrs:{label:"Password",prop:"password"}},[r("el-input",{attrs:{size:"small",type:"password",maxlength:"255","show-password":""},model:{value:e.user.password,callback:function(t){e.$set(e.user,"password","string"==typeof t?t.trim():t)},expression:"user.password"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"Email",prop:"email"}},[r("el-input",{attrs:{size:"small"},model:{value:e.user.email,callback:function(t){e.$set(e.user,"email","string"==typeof t?t.trim():t)},expression:"user.email"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"Mobile",prop:"mobile"}},[r("el-input",{attrs:{size:"small"},model:{value:e.user.mobile,callback:function(t){e.$set(e.user,"mobile",e._n(t))},expression:"user.mobile"}})],1),e._v(" "),r("el-form-item",[r("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.updateUser("user")}}},[e._v("Update")]),e._v(" "),r("el-button",{attrs:{size:"small"},on:{click:function(t){return e.resetUser("user")}}},[e._v("Reset")])],1)],1)],1)])},staticRenderFns:[]},!1,function(e){r("/w8a")},"data-v-030fc32e",null).exports,me={methods:{toDashboard:function(){this.$router.push({name:"dashboard",params:{groupId:this.currentGroup.groupId}})}},computed:{currentGroup:function(){return Le.getters.getCurrentGroup}}},pe=r("C7Lr")(me,{render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"page-container"},[r("p",{staticClass:"code"},[e._v("404")]),e._v(" "),r("div",[r("el-link",{on:{click:function(t){return e.toDashboard()}}},[e._v("Back to home page")])],1)])},staticRenderFns:[]},!1,function(e){r("+HVg")},"data-v-e9d89e56",null).exports;s.default.use(g.a);var fe=new g.a({routes:[{path:"/login",name:"login",component:y,hidden:!0},{path:"/register",name:"register",component:b,hidden:!0},{path:"/",name:"index",component:x,children:[{name:"dashboard",path:"/dashboard/group/:groupId",component:D},{name:"redis-monitor",path:"/redis-monitor/cluster/:clusterId",component:W},{name:"redis-manage",path:"/redis-manage/cluster/:clusterId",component:te},{name:"installation",path:"/installation/group/:groupId",component:ne},{name:"machine-manage",path:"/machine-manage/group/:groupId",component:le},{name:"profile",path:"/profile/:userId",component:de}]},{path:"/404",component:pe,name:"404",hidden:!0},{path:"*",hidden:!0,redirect:{path:"/404"}}]}),ve=fe;function ge(e,t,r,s,i){o()({method:e,url:t,headers:{UserIp:Le.getters.getUserIp},data:"POST"===e||"PUT"===e?r:null,params:"GET"===e||"DELETE"===e?r:null}).then(function(e){s(e)}).catch(function(e){!e.response||401!==e.response.code&&404!==e.response.status?i(e):v.warning("user infomation has expried,please login!")})}fe.beforeEach(function(e,t,r){var s=Le.getters.getUser,i=e.path;if("/login"!==i&&(l(s)||l(s.userId)||l(s.userName)||l(s.userRole))){var a=e.query.code;if(l(a))r({path:"login"});else{var n="/user/oauth2Login?code="+a;he.get(n,null,function(e){var t=e.data;0===t.code?(Le.dispatch("setUser",t.data),r()):r({path:"login"})},function(){r({path:"login"})})}}else 1===s.userRole&&i.indexOf("group-manage")>0?r({name:"dashboard",params:{groupId:Le.getters.getCurrentGroup.groupId}}):2===s.userRole&&(i.indexOf("group-manage")>0||i.indexOf("user-manage")>0||i.indexOf("machine-manage")>0||i.indexOf("installation")>0||i.indexOf("channel-manage")>0||i.indexOf("rule-manage")>0||i.indexOf("redis-manage")>0||i.indexOf("alert-manage")>0||i.indexOf("edit-history")>0)?r({name:"dashboard",params:{groupId:Le.getters.getCurrentGroup.groupId}}):r()});var he={get:function(e,t,r,s){return ge("GET",e,t,r,s)},post:function(e,t,r,s){return ge("POST",e,t,r,s)},put:function(e,t,r,s){return ge("PUT",e,t,r,s)},delete:function(e,t,r,s){return ge("DELETE",e,t,r,s)}},be=r("sqb0");s.default.use(i.a);var _e={currentGroup:{},groupList:[],user:{userRole:2},installationEnvironmentList:[],authorization:{},userIp:""},we={setCurrentGroup:function(e,t){(function(e,t){if(!l(e)&&!l(t)){var r={groupId:e,userId:t};he.post("/user/getUserRole/",r,function(e){var t=e.data.data;_e.user.userRole=t},function(){_e.user.userRole=2})}})(t.groupId,e.user.userId),e.currentGroup=t},setGroupList:function(e,t){e.groupList=t},setUser:function(e,t){e.user=t},setUserRole:function(e,t){e.user.userRole=t},setInstallationEnvironmentList:function(e,t){e.installationEnvironmentList=t},setAuthorization:function(e,t){e.authorization=t},setUserIp:function(e,t){e.userIp=t}},ye={setCurrentGroup:function(e,t){e.commit("setCurrentGroup",t)},setGroupList:function(e,t){e.commit("setGroupList",t)},setUser:function(e,t){var r=t.avatar;l(ie)||l(r)||r.startsWith(ie)||r.startsWith("http")||(t.avatar=ie+r),e.commit("setUser",t)},setUserRole:function(e,t){e.commit("setUserRole",t)},setInstallationEnvironmentList:function(e,t){e.commit("setInstallationEnvironmentList",t)},setAuthorization:function(e,t){e.commit("setAuthorization",t)},setUserIp:function(e,t){e.commit("setUserIp",t)}},Le=new i.a.Store({state:_e,getters:{getCurrentGroup:function(e){return e.currentGroup},getGroupList:function(e){return e.groupList},getUser:function(e){return e.user},getUserId:function(e){return e.user.userId},getUserRole:function(e){return e.user.userRole},getInstallationEnvironmentList:function(e){return e.installationEnvironmentList},getAuthorization:function(e){return e.authorization},getUserIp:function(e){return e.userIp}},actions:ye,mutations:we,plugins:[Object(a.a)({storage:{getItem:function(e){return be.get(e)},setItem:function(e,t){return be.set(e,t,{expires:1})},removeItem:function(e){return be.remove(e)}},reducer:function(e){return{user:e.user,currentGroup:e.currentGroup,groupList:e.groupList}}})]});var Ce={name:"App",methods:{getInstallationEnvironmentList:function(){he.get("/system/getInstallationEnvironment",null,function(e){var t=[];e.data.data.forEach(function(e){var r="";0===e?r="Docker":1===e?r="Machine":3===e&&(r="Humpback"),l(r)||t.push({type:e,name:r})}),Le.dispatch("setInstallationEnvironmentList",t)},function(e){v.error("Get installation environment failed")})}},mounted:function(){this.getInstallationEnvironmentList()}},Ie=r("C7Lr")(Ce,{render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{attrs:{id:"app"}},[t("transition",{attrs:{name:"fade",mode:"out-in"}},[t("router-view")],1)],1)},staticRenderFns:[]},!1,function(e){r("1csI")},null,null).exports,Ne=r("oE1r"),ke=r.n(Ne);r("09yM"),r("Xcu2"),r("7xIN"),s.default.use(p.a,{locale:ke.a}),s.default.config.productionTip=!1,s.default.prototype.$axios=o.a,o.a.defaults.headers.post["Content-Type"]="application/json;charset=UTF-8",o.a.defaults.baseURL=ie,o.a.defaults.TIMEOUT=3e5,new s.default({el:"#app",vuex:i.a,router:ve,components:{App:Ie},template:"<App/>"})},PVIw:function(e,t){},QGkJ:function(e,t){},R8Uw:function(e,t){},XY94:function(e,t){},Xcu2:function(e,t){},Z2Em:function(e,t){},alXC:function(e,t){},bfE2:function(e,t){},chxV:function(e,t){},eFDd:function(e,t){},hq0Z:function(e,t){},lyAA:function(e,t){},rE9p:function(e,t){},rGuf:function(e,t){},scWc:function(e,t){},y6th:function(e,t){},yZWR:function(e,t){}},["NHnr"]);
//# sourceMappingURL=app.a23ab04425a97893d1c7.js.map